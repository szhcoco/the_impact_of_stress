<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Academic Stress Analytics | Physiology & Performance</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700&family=Playfair+Display:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-light: #f8f9fa;
            --primary-dark: #212529;
            --secondary-light: #e9ecef;
            --accent-blue: #4cc9f0;
            --accent-green: #80ed99;
            --accent-yellow: #ffd166;
            --accent-red: #f07167;
            --accent-purple: #9d4edd;
            --pre-test: #6a89cc;
            --in-test: #f8c291;
            --post-test: #82ccdd;
            --text-dark: #343a40;
            --text-light: #f8f9fa;
            --text-muted: #6c757d;
            --transition: all 0.4s ease;
            --shadow-sm: 0 4px 12px rgba(0, 0, 0, 0.05);
            --shadow-md: 0 8px 24px rgba(0, 0, 0, 0.08);
            --shadow-lg: 0 12px 36px rgba(0, 0, 0, 0.1);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Montserrat', sans-serif;
            background-color: var(--primary-light);
            color: var(--text-dark);
            line-height: 1.7;
            overflow-x: hidden;
            background-image: 
                radial-gradient(circle at 10% 20%, rgba(76, 201, 240, 0.03) 0%, transparent 20%),
                radial-gradient(circle at 90% 80%, rgba(128, 237, 153, 0.03) 0%, transparent 20%);
        }
        
        h1, h2, h3, h4 {
            font-family: 'Playfair Display', serif;
            font-weight: 600;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
        }
        
        /* Header */
        header {
            background: linear-gradient(135deg, var(--accent-purple) 0%, var(--accent-blue) 100%);
            color: white;
            padding: 20px 0;
            box-shadow: var(--shadow-md);
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .logo-icon {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }
        
        .logo-text {
            font-size: 1.8rem;
            font-weight: 700;
        }
        
        /* Hero Section */
        .hero {
            padding: 60px 0 30px;
            text-align: center;
        }
        
        .hero-title {
            font-size: 2.8rem;
            margin-bottom: 15px;
            background: linear-gradient(135deg, var(--accent-purple), var(--accent-blue));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }
        
        .hero-subtitle {
            font-size: 1.2rem;
            color: var(--text-muted);
            max-width: 800px;
            margin: 0 auto 30px;
        }
        
        /* Dashboard Controls */
        .dashboard-controls {
            background: white;
            border-radius: 16px;
            padding: 25px;
            box-shadow: var(--shadow-md);
            margin: 30px 0;
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            justify-content: center;
        }
        
        .control-group {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .control-label {
            font-weight: 500;
            color: var(--text-muted);
        }
        
        select, button {
            background: white;
            color: var(--text-dark);
            border: 1px solid #dee2e6;
            padding: 10px 20px;
            border-radius: 30px;
            font-family: 'Montserrat', sans-serif;
            font-size: 14px;
            cursor: pointer;
            transition: var(--transition);
            box-shadow: var(--shadow-sm);
        }
        
        select:hover, button:hover {
            border-color: var(--accent-blue);
            box-shadow: 0 5px 15px rgba(76, 201, 240, 0.1);
        }
        
        button.primary {
            background: var(--accent-purple);
            color: white;
            border-color: var(--accent-purple);
        }
        
        button.primary:hover {
            background: #8a3dbf;
            transform: translateY(-2px);
        }
        
        /* Dashboard Grid */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 25px;
            margin-bottom: 40px;
        }
        
        .grid-card {
            background: white;
            border-radius: 16px;
            padding: 30px;
            box-shadow: var(--shadow-md);
            transition: var(--transition);
            display: flex;
            flex-direction: column;
        }
        
        .grid-card:hover {
            box-shadow: var(--shadow-lg);
            transform: translateY(-5px);
        }
        
        .card-header {
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .card-icon {
            width: 50px;
            height: 50px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            background: rgba(76, 201, 240, 0.1);
            color: var(--accent-blue);
        }
        
        .card-title {
            font-size: 1.4rem;
            color: var(--text-dark);
        }
        
        .card-description {
            color: var(--text-muted);
            margin-bottom: 20px;
            font-size: 0.95rem;
        }
        
        .chart-container {
            height: 300px;
            position: relative;
            margin: 10px 0 20px;
            flex-grow: 1;
        }
        
        /* Data Loading Indicator */
        .loading-indicator {
            text-align: center;
            padding: 20px;
            color: var(--accent-purple);
            font-size: 1.2rem;
        }
        
        .loading-indicator i {
            animation: spin 1s infinite linear;
            margin-right: 10px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Tooltip */
        .tooltip {
            position: absolute;
            background: rgba(255, 255, 255, 0.95);
            border: 1px solid var(--accent-blue);
            border-radius: 8px;
            padding: 15px;
            pointer-events: none;
            font-size: 14px;
            box-shadow: var(--shadow-lg);
            z-index: 100;
            opacity: 0;
            transition: opacity 0.3s;
            max-width: 300px;
            backdrop-filter: blur(5px);
        }
        
        .tooltip-title {
            font-weight: 600;
            margin-bottom: 5px;
            color: var(--accent-purple);
        }
        
        .tooltip-content {
            color: var(--text-muted);
            line-height: 1.6;
        }
        
        /* Performance Section */
        .performance-section {
            background: white;
            border-radius: 16px;
            padding: 40px;
            box-shadow: var(--shadow-md);
            margin: 50px 0;
        }
        
        .performance-content {
            max-width: 900px;
            margin: 0 auto;
        }
        
        /* Footer */
        footer {
            background: var(--primary-dark);
            color: var(--text-light);
            padding: 60px 0 30px;
            margin-top: 60px;
        }
        
        .footer-content {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 30px;
        }
        
        .footer-column h3 {
            font-size: 1.3rem;
            margin-bottom: 20px;
            color: var(--accent-blue);
        }
        
        .footer-column ul {
            list-style: none;
        }
        
        .footer-column li {
            margin-bottom: 10px;
        }
        
        .footer-column a {
            color: var(--text-muted);
            text-decoration: none;
            transition: var(--transition);
        }
        
        .footer-column a:hover {
            color: var(--accent-blue);
        }
        
        .copyright {
            text-align: center;
            padding-top: 30px;
            margin-top: 30px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            color: var(--text-muted);
        }
        
        /* Responsive Design */
        @media (max-width: 1200px) {
            .dashboard-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        @media (max-width: 768px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
            
            .footer-content {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header>
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <div class="logo-icon">
                        <i class="fas fa-heartbeat"></i>
                    </div>
                    <div class="logo-text">Academic Stress Analytics</div>
                </div>
                <div class="controls">
                    <button class="primary" id="load-data-btn">
                        <i class="fas fa-database"></i> Load Dataset
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- Hero Section -->
    <section class="hero">
        <div class="container">
            <h1 class="hero-title">Physiological Response to Academic Stress</h1>
            <p class="hero-subtitle">Explore how students' physiological signals change during exams across pre-test, in-test, and post-test periods</p>
        </div>
    </section>

    <!-- Dashboard Controls -->
    <div class="container">
        <div class="dashboard-controls">
            <div class="control-group">
                <span class="control-label">Student:</span>
                <select id="student-select">
                    <option value="S1">Student 1</option>
                    <option value="S2">Student 2</option>
                    <option value="S3">Student 3</option>
                    <option value="S4">Student 4</option>
                    <option value="S5">Student 5</option>
                    <option value="S6">Student 6</option>
                    <option value="S7">Student 7</option>
                    <option value="S8">Student 8</option>
                    <option value="S9">Student 9</option>
                    <option value="S10">Student 10</option>
                </select>
            </div>
            
            <div class="control-group">
                <span class="control-label">Signal:</span>
                <select id="signal-select">
                    <option value="HR">Heart Rate</option>
                    <option value="EDA">Electrodermal Activity</option>
                    <option value="TEMP">Temperature</option>
                    <option value="BVP">Blood Volume Pulse</option>
                </select>
            </div>
            
            <button id="refresh-btn" class="primary">
                <i class="fas fa-sync-alt"></i> Update Visualizations
            </button>
        </div>
    </div>

    <!-- Loading Indicator -->
    <div class="container">
        <div class="loading-indicator" id="loading-indicator" style="display: none;">
            <i class="fas fa-spinner"></i> Loading and processing physiological data...
        </div>
    </div>

    <!-- Dashboard Grid -->
    <div class="container">
        <div class="dashboard-grid">
            <!-- Midterm 1 Card -->
            <div class="grid-card">
                <div class="card-header">
                    <div class="card-icon">
                        <i class="fas fa-book"></i>
                    </div>
                    <h3 class="card-title">Midterm 1 Analysis</h3>
                </div>
                <div class="card-description">
                    Physiological response during the first midterm exam (1.5 hours)
                </div>
                <div class="chart-container" id="midterm1-chart"></div>
                <div class="card-footer">
                    <span class="highlight">Pre-test: 15 min</span> | 
                    <span class="warning">In-test: 90 min</span> | 
                    <span class="danger">Post-test: 15 min</span>
                </div>
            </div>
            
            <!-- Midterm 2 Card -->
            <div class="grid-card">
                <div class="card-header">
                    <div class="card-icon">
                        <i class="fas fa-book"></i>
                    </div>
                    <h3 class="card-title">Midterm 2 Analysis</h3>
                </div>
                <div class="card-description">
                    Physiological response during the second midterm exam (1.5 hours)
                </div>
                <div class="chart-container" id="midterm2-chart"></div>
                <div class="card-footer">
                    <span class="highlight">Pre-test: 15 min</span> | 
                    <span class="warning">In-test: 90 min</span> | 
                    <span class="danger">Post-test: 15 min</span>
                </div>
            </div>
            
            <!-- Final Exam Card -->
            <div class="grid-card">
                <div class="card-header">
                    <div class="card-icon">
                        <i class="fas fa-graduation-cap"></i>
                    </div>
                    <h3 class="card-title">Final Exam Analysis</h3>
                </div>
                <div class="card-description">
                    Physiological response during the final exam (3 hours)
                </div>
                <div class="chart-container" id="final-chart"></div>
                <div class="card-footer">
                    <span class="highlight">Pre-test: 15 min</span> | 
                    <span class="warning">In-test: 180 min</span> | 
                    <span class="danger">Post-test: 15 min</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Performance Section -->
    <div class="container">
        <div class="performance-section">
            <div class="performance-content">
                <h2>How Physiological Signals Relate to Academic Performance</h2>
                
                <div class="chart-container" id="performance-chart"></div>
                
                <div class="controls" style="background: transparent; box-shadow: none; padding: 10px 0; justify-content: center;">
                    <div class="control-group">
                        <span class="control-label">Exam Period:</span>
                        <select id="period-select">
                            <option value="pre-test">Pre-Test</option>
                            <option value="in-test">In-Test</option>
                            <option value="post-test">Post-Test</option>
                        </select>
                    </div>
                </div>
                
                <p style="text-align: center; margin-top: 20px; max-width: 800px; margin-left: auto; margin-right: auto;">
                    This visualization shows the relationship between physiological responses during different exam periods 
                    and final exam grades. Each point represents a student's average signal measurement during the selected period 
                    and their overall grade.
                </p>
            </div>
        </div>
    </div>

    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-column">
                    <h3>Academic Stress Analytics</h3>
                    <p>Understanding how physiological responses impact academic achievement across exam periods.</p>
                </div>
                
                <div class="footer-column">
                    <h3>Research Areas</h3>
                    <ul>
                        <li><a href="#">Stress Physiology</a></li>
                        <li><a href="#">Academic Performance</a></li>
                        <li><a href="#">Biometric Sensing</a></li>
                        <li><a href="#">Cognitive Load</a></li>
                    </ul>
                </div>
                
                <div class="footer-column">
                    <h3>Data Resources</h3>
                    <ul>
                        <li><a href="#">Research Papers</a></li>
                        <li><a href="#">Dataset Access</a></li>
                        <li><a href="#">Visualization Tools</a></li>
                        <li><a href="#">Analysis Methods</a></li>
                    </ul>
                </div>
                
                <div class="footer-column">
                    <h3>Connect</h3>
                    <ul>
                        <li><a href="#"><i class="fab fa-github"></i> GitHub</a></li>
                        <li><a href="#"><i class="fab fa-twitter"></i> Twitter</a></li>
                        <li><a href="#"><i class="fab fa-linkedin"></i> LinkedIn</a></li>
                        <li><a href="#"><i class="fas fa-envelope"></i> Contact</a></li>
                    </ul>
                </div>
            </div>
            
            <div class="copyright">
                <p>&copy; 2023 Academic Stress Analytics | Physiology & Performance Research</p>
            </div>
        </div>
    </footer>

    <script>
        // Dataset structure handler
        class DataHandler {
            constructor() {
                this.datasetPath = 'dataset/';
                this.students = ['S1', 'S2', 'S3', 'S4', 'S5', 'S6', 'S7', 'S8', 'S9', 'S10'];
                this.exams = ['Midterm 1', 'Midterm 2', 'Final'];
                this.signals = ['HR', 'EDA', 'TEMP', 'BVP'];
                this.grades = {
                    'S1': { 'Midterm 1': 78, 'Midterm 2': 82, 'Final': 182 },
                    'S2': { 'Midterm 1': 82, 'Midterm 2': 85, 'Final': 180 },
                    'S3': { 'Midterm 1': 77, 'Midterm 2': 90, 'Final': 188 },
                    'S4': { 'Midterm 1': 75, 'Midterm 2': 77, 'Final': 149 },
                    'S5': { 'Midterm 1': 67, 'Midterm 2': 77, 'Final': 157 },
                    'S6': { 'Midterm 1': 71, 'Midterm 2': 64, 'Final': 175 },
                    'S7': { 'Midterm 1': 64, 'Midterm 2': 33, 'Final': 110 },
                    'S8': { 'Midterm 1': 92, 'Midterm 2': 88, 'Final': 184 },
                    'S9': { 'Midterm 1': 80, 'Midterm 2': 39, 'Final': 126 },
                    'S10': { 'Midterm 1': 89, 'Midterm 2': 64, 'Final': 116 }
                };
                this.loadedData = {};
            }
            
            // Get file path based on student, exam, and signal
            getFilePath(student, exam, signal) {
                return `${this.datasetPath}${student}_processed/${exam}/${signal}.csv`;
            }
            
            // Load and parse CSV data
            async loadCSVData(filePath) {
                try {
                    const response = await fetch(filePath);
                    if (!response.ok) throw new Error(`Failed to fetch ${filePath}`);
                    
                    const csvText = await response.text();
                    return this.parseCSV(csvText);
                } catch (error) {
                    console.error('Error loading CSV:', error);
                    return null;
                }
            }
            
            // Parse CSV text into structured data
            parseCSV(csvText) {
                const rows = csvText.split('\n').slice(1); // Skip header row
                const data = [];
                
                for (const row of rows) {
                    if (!row.trim()) continue;
                    
                    const [signal, timestamp, relativeSeconds, period] = row.split(',');
                    
                    data.push({
                        signal: signal.trim(),
                        timestamp: timestamp.trim(),
                        relativeSeconds: parseFloat(relativeSeconds),
                        period: period.trim(),
                        value: parseFloat(signal) // Assuming signal value is the first column
                    });
                }
                
                return data;
            }
            
            // Load data for a specific student and signal across all exams
            async loadStudentData(student, signal) {
                const studentData = {};
                
                for (const exam of this.exams) {
                    const filePath = this.getFilePath(student, exam, signal);
                    studentData[exam] = await this.loadCSVData(filePath);
                }
                
                this.loadedData[student] = this.loadedData[student] || {};
                this.loadedData[student][signal] = studentData;
                
                return studentData;
            }
            
            // Get grade for a student and exam
            getGrade(student, exam) {
                return this.grades[student]?.[exam] || null;
            }
            
            // Generate mock data for demonstration purposes
            generateMockData(student, exam, signal) {
                const duration = exam === 'Final' ? 180 : 90; // minutes
                const data = [];
                const startTime = new Date();
                
                for (let i = 0; i < duration * 60; i += 10) { // 10-second intervals
                    let value;
                    let period;
                    
                    // Determine period
                    if (i < 15 * 60) period = 'pre-test';
                    else if (i < (duration - 15) * 60) period = 'in-test';
                    else period = 'post-test';
                    
                    // Generate values based on signal type
                    if (signal === 'HR') {
                        // Heart rate: baseline 70-80, increases during test
                        value = 70 + Math.random() * 10;
                        if (period === 'in-test') value += 15 + Math.random() * 10;
                    } else if (signal === 'EDA') {
                        // EDA: baseline 1-3, increases during test
                        value = 1 + Math.random() * 2;
                        if (period === 'in-test') value += 3 + Math.random() * 2;
                    } else if (signal === 'TEMP') {
                        // Temperature: baseline 36-37, decreases during stress
                        value = 36.0 + Math.random() * 1.0;
                        if (period === 'in-test') value -= 0.5 + Math.random() * 0.5;
                    } else if (signal === 'BVP') {
                        // BVP: baseline 0.4-0.6, decreases during stress
                        value = 0.4 + Math.random() * 0.2;
                        if (period === 'in-test') value -= 0.1 + Math.random() * 0.1;
                    }
                    
                    // Add some noise and variation
                    value += (Math.random() - 0.5) * (value * 0.1);
                    
                    // Create data point
                    data.push({
                        signal: signal,
                        timestamp: new Date(startTime.getTime() + i * 1000).toISOString(),
                        relativeSeconds: i,
                        period: period,
                        value: value
                    });
                }
                
                return data;
            }
        }

        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', function() {
            const dataHandler = new DataHandler();
            let currentStudent = 'S1';
            let currentSignal = 'HR';
            
            // DOM elements
            const studentSelect = document.getElementById('student-select');
            const signalSelect = document.getElementById('signal-select');
            const refreshBtn = document.getElementById('refresh-btn');
            const loadDataBtn = document.getElementById('load-data-btn');
            const loadingIndicator = document.getElementById('loading-indicator');
            const periodSelect = document.getElementById('period-select');
            
            // Initialize charts with empty data
            renderTimelineChart('midterm1-chart', [], 'Midterm 1', currentSignal);
            renderTimelineChart('midterm2-chart', [], 'Midterm 2', currentSignal);
            renderTimelineChart('final-chart', [], 'Final', currentSignal);
            renderPerformanceChart(dataHandler, currentSignal);
            
            // Load data button
            loadDataBtn.addEventListener('click', async function() {
                try {
                    loadingIndicator.style.display = 'block';
                    
                    // Get current selections
                    currentStudent = studentSelect.value;
                    currentSignal = signalSelect.value;
                    
                    // Load data for the selected student and signal
                    await dataHandler.loadStudentData(currentStudent, currentSignal);
                    
                    // Update charts
                    updateCharts(dataHandler, currentStudent, currentSignal);
                    
                    loadingIndicator.style.display = 'none';
                } catch (error) {
                    console.error('Error loading data:', error);
                    loadingIndicator.style.display = 'none';
                    alert('Error loading data. Using mock data for demonstration.');
                    useMockData(dataHandler, currentStudent, currentSignal);
                }
            });
            
            // Refresh button
            refreshBtn.addEventListener('click', function() {
                currentStudent = studentSelect.value;
                currentSignal = signalSelect.value;
                updateCharts(dataHandler, currentStudent, currentSignal);
            });
            
            // Period select change
            periodSelect.addEventListener('change', function() {
                renderPerformanceChart(dataHandler, currentSignal);
            });
            
            // Use mock data for initial demonstration
            useMockData(dataHandler, currentStudent, currentSignal);
        });
        
        // Use mock data for demonstration
        function useMockData(dataHandler, student, signal) {
            const mockData = {};
            
            for (const exam of dataHandler.exams) {
                mockData[exam] = dataHandler.generateMockData(student, exam, signal);
            }
            
            dataHandler.loadedData[student] = dataHandler.loadedData[student] || {};
            dataHandler.loadedData[student][signal] = mockData;
            
            updateCharts(dataHandler, student, signal);
        }
        
        // Update all charts
        function updateCharts(dataHandler, student, signal) {
            const studentData = dataHandler.loadedData[student]?.[signal];
            
            if (studentData) {
                renderTimelineChart('midterm1-chart', studentData['Midterm 1'], 'Midterm 1', signal);
                renderTimelineChart('midterm2-chart', studentData['Midterm 2'], 'Midterm 2', signal);
                renderTimelineChart('final-chart', studentData['Final'], 'Final', signal);
            }
            
            renderPerformanceChart(dataHandler, signal);
        }
        
        // Render timeline chart
        function renderTimelineChart(containerId, data, examTitle, signal) {
            const container = d3.select(`#${containerId}`);
            container.html('');
            
            // Add tooltip
            const tooltip = container.append('div')
                .attr('class', 'tooltip');
            
            const width = container.node().clientWidth;
            const height = container.node().clientHeight;
            const margin = { top: 30, right: 30, bottom: 50, left: 60 };
            const innerWidth = width - margin.left - margin.right;
            const innerHeight = height - margin.top - margin.bottom;
            
            // Create SVG
            const svg = container.append('svg')
                .attr('width', width)
                .attr('height', height)
                .append('g')
                .attr('transform', `translate(${margin.left},${margin.top})`);
            
            // If no data, show message
            if (!data || data.length === 0) {
                svg.append('text')
                    .attr('x', innerWidth / 2)
                    .attr('y', innerHeight / 2)
                    .attr('text-anchor', 'middle')
                    .attr('fill', '#6c757d')
                    .text('Load data to visualize physiological signals');
                return;
            }
            
            // Scales
            const xScale = d3.scaleLinear()
                .domain([0, d3.max(data, d => d.relativeSeconds) || 100])
                .range([0, innerWidth]);
            
            const yMin = d3.min(data, d => d.value) * 0.95;
            const yMax = d3.max(data, d => d.value) * 1.05;
            const yScale = d3.scaleLinear()
                .domain([yMin, yMax])
                .range([innerHeight, 0]);
            
            // Color scale for periods
            const colorScale = d3.scaleOrdinal()
                .domain(['pre-test', 'in-test', 'post-test'])
                .range(['#6a89cc', '#f8c291', '#82ccdd']);
            
            // Draw period backgrounds
            const periodBoundaries = {
                'pre-test': { start: 0, end: 15 * 60 },
                'in-test': { 
                    start: 15 * 60, 
                    end: (examTitle === 'Final' ? 180 : 90) * 60 - 15 * 60 
                },
                'post-test': { 
                    start: (examTitle === 'Final' ? 180 : 90) * 60 - 15 * 60, 
                    end: (examTitle === 'Final' ? 180 : 90) * 60 
                }
            };
            
            for (const [period, boundary] of Object.entries(periodBoundaries)) {
                svg.append('rect')
                    .attr('x', xScale(boundary.start))
                    .attr('y', 0)
                    .attr('width', xScale(boundary.end - boundary.start))
                    .attr('height', innerHeight)
                    .attr('fill', colorScale(period))
                    .attr('opacity', 0.1);
            }
            
            // Line generator
            const line = d3.line()
                .x(d => xScale(d.relativeSeconds))
                .y(d => yScale(d.value))
                .curve(d3.curveMonotoneX);
            
            // Draw line
            svg.append('path')
                .datum(data)
                .attr('fill', 'none')
                .attr('stroke', '#9d4edd')
                .attr('stroke-width', 2)
                .attr('d', line);
            
            // Draw dots for interaction
            const dots = svg.selectAll('.dot')
                .data(data.filter((d, i) => i % 20 === 0)) // Sample points for performance
                .enter()
                .append('circle')
                .attr('class', 'dot')
                .attr('cx', d => xScale(d.relativeSeconds))
                .attr('cy', d => yScale(d.value))
                .attr('r', 3)
                .attr('fill', d => colorScale(d.period))
                .attr('stroke', '#fff')
                .attr('stroke-width', 1)
                .on('mouseover', function(event, d) {
                    // Position tooltip
                    const xPos = event.pageX;
                    const yPos = event.pageY;
                    
                    // Update tooltip content
                    tooltip.html(`
                        <div class="tooltip-title">${d.period.replace('-', ' ').toUpperCase()}</div>
                        <div class="tooltip-content">
                            <p>Time: ${Math.floor(d.relativeSeconds/60)}:${(d.relativeSeconds%60).toString().padStart(2, '0')}</p>
                            <p>${signal}: ${d.value.toFixed(2)}</p>
                        </div>
                    `)
                    .style('left', (xPos + 10) + 'px')
                    .style('top', (yPos - 20) + 'px')
                    .style('opacity', 1);
                })
                .on('mouseout', function() {
                    tooltip.style('opacity', 0);
                });
            
            // Add axes
            const xAxis = d3.axisBottom(xScale)
                .ticks(6)
                .tickFormat(d => {
                    const mins = Math.floor(d / 60);
                    return `${mins} min`;
                });
                
            const yAxis = d3.axisLeft(yScale).ticks(5);
            
            svg.append('g')
                .attr('transform', `translate(0,${innerHeight})`)
                .call(xAxis);
            
            svg.append('g')
                .call(yAxis);
            
            // Add axis labels
            svg.append('text')
                .attr('x', innerWidth / 2)
                .attr('y', innerHeight + margin.bottom - 10)
                .attr('text-anchor', 'middle')
                .attr('fill', '#6c757d')
                .text('Exam Time');
            
            svg.append('text')
                .attr('transform', 'rotate(-90)')
                .attr('x', -innerHeight / 2)
                .attr('y', -margin.left + 15)
                .attr('text-anchor', 'middle')
                .attr('fill', '#6c757d')
                .text(signal);
            
            // Add chart title
            svg.append('text')
                .attr('x', innerWidth / 2)
                .attr('y', -10)
                .attr('text-anchor', 'middle')
                .attr('fill', '#343a40')
                .attr('font-weight', '600')
                .text(examTitle);
        }
        
        // Render performance chart
        function renderPerformanceChart(dataHandler, signal) {
            const container = d3.select('#performance-chart');
            container.html('');
            
            const width = container.node().clientWidth;
            const height = container.node().clientHeight;
            const margin = { top: 30, right: 30, bottom: 60, left: 60 };
            const innerWidth = width - margin.left - margin.right;
            const innerHeight = height - margin.top - margin.bottom;
            
            // Create SVG
            const svg = container.append('svg')
                .attr('width', width)
                .attr('height', height)
                .append('g')
                .attr('transform', `translate(${margin.left},${margin.top})`);
            
            // Get selected period
            const period = document.getElementById('period-select').value;
            
            // Generate mock data for demonstration
            const data = [];
            for (const student of dataHandler.students) {
                // Get grade for the final exam
                const grade = dataHandler.getGrade(student, 'Final');
                
                // Generate mock signal value for the selected period
                let signalValue;
                if (signal === 'HR') {
                    signalValue = 70 + Math.random() * 15;
                    if (period === 'in-test') signalValue += 10 + Math.random() * 10;
                } else if (signal === 'EDA') {
                    signalValue = 2 + Math.random() * 3;
                    if (period === 'in-test') signalValue += 2 + Math.random() * 2;
                } else if (signal === 'TEMP') {
                    signalValue = 36.0 + Math.random() * 1.0;
                    if (period === 'in-test') signalValue -= 0.4 + Math.random() * 0.4;
                } else if (signal === 'BVP') {
                    signalValue = 0.4 + Math.random() * 0.2;
                    if (period === 'in-test') signalValue -= 0.1 + Math.random() * 0.1;
                }
                
                data.push({
                    student: student,
                    signal: signalValue,
                    grade: grade
                });
            }
            
            // Scales for the grades
            const xScale = d3.scaleLinear()
                .domain([d3.min(data, d => d.signal) * 0.9, d3.max(data, d => d.signal) * 1.1])
                .range([0, innerWidth]);
            
            const yScale = d3.scaleLinear()
                .domain(d3.extent(dataHandler, d => d.grade))
                .range([innerHeight, 0]);
            
            // Draw points
            svg.selectAll('.point')
                .data(data)
                .enter()
                .append('circle')
                .attr('class', 'point')
                .attr('cx', d => xScale(d.signal))
                .attr('cy', d => yScale(d.grade))
                .attr('r', 8)
                .attr('fill', '#9d4edd')
                .attr('opacity', 0.7);
            
            // Add trend line
            const line = d3.line()
                .x(d => xScale(d.signal))
                .y(d => yScale(d.grade));
            
            const trendData = data.map(d => ({signal: d.signal, grade: d.grade}))
                .sort((a, b) => a.signal - b.signal);
            
            svg.append('path')
                .datum(trendData)
                .attr('fill', 'none')
                .attr('stroke', '#4cc9f0')
                .attr('stroke-width', 2)
                .attr('d', line);
            
            // Add axes
            const xAxis = d3.axisBottom(xScale).ticks(5);
            const yAxis = d3.axisLeft(yScale).ticks(5);
            
            svg.append('g')
                .attr('transform', `translate(0,${innerHeight})`)
                .call(xAxis);
            
            svg.append('g')
                .call(yAxis);
            
            // Add axis labels
            svg.append('text')
                .attr('x', innerWidth / 2)
                .attr('y', innerHeight + margin.bottom - 10)
                .attr('text-anchor', 'middle')
                .attr('fill', '#6c757d')
                .text(`Average ${signal} during ${period.replace('-', ' ')}`);
            
            svg.append('text')
                .attr('transform', 'rotate(-90)')
                .attr('x', -innerHeight / 2)
                .attr('y', -margin.left + 15)
                .attr('text-anchor', 'middle')
                .attr('fill', '#6c757d')
                .text('Final Exam Grade');
            
            // Add title
            svg.append('text')
                .attr('x', innerWidth / 2)
                .attr('y', -10)
                .attr('text-anchor', 'middle')
                .attr('fill', '#343a40')
                .attr('font-weight', '600')
                .text(`Performance vs. ${signal} during ${period.replace('-', ' ')}`);
        }
    </script>
</body>
</html>