<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Academic Stress Analytics</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Playfair+Display:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.9.0/d3.min.js"></script>
  <style>
    :root {
      --primary: #0f172a;
      --primary-light: #f8fafc;
      --secondary: #475569;
      --accent-blue: #3b82f6;
      --accent-green: #10b981;
      --accent-yellow: #f59e0b;
      --accent-red: #ef4444;
      --accent-purple: #8b5cf6;
      --accent-indigo: #6366f1;
      --pre-test: #64748b;
      --in-test: #f97316;
      --post-test: #06b6d4;
      --text-dark: #1e293b;
      --text-light: #f1f5f9;
      --text-muted: #64748b;
      --border: #e2e8f0;
      --glass-bg: rgba(255, 255, 255, 0.1);
      --glass-border: rgba(255, 255, 255, 0.2);
      --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.1);
      --shadow-md: 0 4px 12px rgba(0, 0, 0, 0.1);
      --shadow-lg: 0 10px 25px rgba(0, 0, 0, 0.15);
      --gradient-main: linear-gradient(135deg, var(--accent-purple), var(--accent-blue));
      --gradient-warm: linear-gradient(135deg, var(--accent-yellow), var(--accent-red));
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    html {
      scroll-behavior: smooth;
    }

    body {
      font-family: 'Inter', sans-serif;
      background: var(--primary-light);
      color: var(--text-dark);
      line-height: 1.6;
      overflow-x: hidden;
    }

    h1, h2, h3, h4 {
      font-family: 'Playfair Display', serif;
      font-weight: 600;
      line-height: 1.2;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 1.5rem;
    }

    /* Header */
    header {
      background: var(--gradient-main);
      color: white;
      padding: 1rem 0;
      position: fixed;
      top: 0;
      width: 100%;
      z-index: 1000;
      backdrop-filter: blur(10px);
    }

    .header-content {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }

    .logo-icon {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: var(--glass-bg);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.25rem;
      border: 1px solid var(--glass-border);
    }

    .logo-text {
      font-size: 1.25rem;
      font-weight: 700;
    }

    /* Navigation */
    .nav-progress {
      position: fixed;
      right: 1.5rem;
      top: 50%;
      transform: translateY(-50%);
      z-index: 1000;
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }

    .nav-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.3);
      cursor: pointer;
      transition: all 0.3s ease;
      position: relative;
    }

    .nav-dot.active {
      background: var(--accent-purple);
      transform: scale(1.5);
    }

    .nav-dot::after {
      content: attr(data-label);
      position: absolute;
      right: 1.5rem;
      top: 50%;
      transform: translateY(-50%);
      background: var(--primary);
      color: white;
      padding: 0.25rem 0.5rem;
      border-radius: 0.25rem;
      font-size: 0.75rem;
      white-space: nowrap;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s ease;
    }

    .nav-dot:hover::after {
      opacity: 1;
    }

    /* Hero Section */
    .hero {
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      background: var(--gradient-main);
      color: white;
      position: relative;
      padding: 6rem 0 4rem;
    }

    .hero-content {
      text-align: center;
      max-width: 800px;
    }

    .hero-title {
      font-size: clamp(2.5rem, 5vw, 4rem);
      margin-bottom: 1.5rem;
      background: linear-gradient(135deg, #ffffff, #e2e8f0);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .hero-subtitle {
      font-size: 1.25rem;
      margin-bottom: 2rem;
      opacity: 0.9;
    }

    .hero-stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 2rem;
      margin-top: 3rem;
    }

    .stat-card {
      background: var(--glass-bg);
      backdrop-filter: blur(10px);
      border: 1px solid var(--glass-border);
      border-radius: 1rem;
      padding: 1.5rem;
      text-align: center;
    }

    .stat-number {
      font-size: 2rem;
      font-weight: 700;
      display: block;
    }

    .stat-label {
      font-size: 0.875rem;
      opacity: 0.8;
    }

    /* Attention grabber animations */
    .attention-grabber {
      margin-bottom: 2rem;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 2rem;
    }

    .floating-question {
      display: flex;
      align-items: center;
      gap: 1rem;
      background: rgba(255, 255, 255, 0.15);
      padding: 1.5rem 2rem;
      border-radius: 2rem;
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.2);
      animation: float 4s ease-in-out infinite;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
    }

    .brain-pulse {
      font-size: 2rem;
      color: #fbbf24;
      animation: pulse-brain 2s ease-in-out infinite;
    }

    @keyframes pulse-brain {
      0%, 100% { 
        transform: scale(1);
        filter: brightness(1);
      }
      50% { 
        transform: scale(1.1);
        filter: brightness(1.2);
      }
    }

    .question-text {
      font-size: 1.1rem;
      font-weight: 500;
      color: white;
    }

    .animated-stats {
      display: flex;
      align-items: center;
      gap: 3rem;
      padding: 2rem;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 1.5rem;
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.15);
    }

    .pulse-indicator {
      position: relative;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 0.5rem;
    }

    .pulse-ring {
      position: absolute;
      top: -10px;
      left: -10px;
      width: 60px;
      height: 60px;
      border: 3px solid #ef4444;
      border-radius: 50%;
      animation: pulse-ring 2s cubic-bezier(0.455, 0.03, 0.515, 0.955) infinite;
      opacity: 0;
    }

    .pulse-ring-delay-1 {
      animation-delay: 0.7s;
    }

    .pulse-ring-delay-2 {
      animation-delay: 1.4s;
    }

    @keyframes pulse-ring {
      0% {
        transform: scale(0.8);
        opacity: 1;
      }
      100% {
        transform: scale(2.5);
        opacity: 0;
      }
    }

    .pulse-bpm {
      background: #ef4444;
      color: white;
      padding: 0.75rem 1.5rem;
      border-radius: 2rem;
      font-weight: 700;
      font-size: 1.1rem;
      animation: bpm-count 2s ease-in-out infinite;
      z-index: 10;
      position: relative;
    }

    @keyframes bpm-count {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.05); }
    }

    .stress-arrow {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 0.5rem;
      animation: arrow-glow 3s ease-in-out infinite;
    }

    .stress-arrow i {
      font-size: 2rem;
      color: #f59e0b;
    }

    .stress-arrow span {
      font-weight: 700;
      color: #f59e0b;
      letter-spacing: 0.1em;
    }

    @keyframes arrow-glow {
      0%, 100% { 
        filter: brightness(1);
        transform: translateX(0);
      }
      50% { 
        filter: brightness(1.3);
        transform: translateX(10px);
      }
    }

    .grade-display {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 0.5rem;
    }

    .grade-number {
      font-size: 3rem;
      font-weight: 900;
      color: #10b981;
      line-height: 1;
      position: relative;
    }

    .grade-animate {
      animation: grade-reveal 4s ease-in-out infinite;
    }

    @keyframes grade-reveal {
      0% { opacity: 0.3; transform: scale(0.8); }
      25% { opacity: 1; transform: scale(1.1); }
      75% { opacity: 1; transform: scale(1); }
      100% { opacity: 0.3; transform: scale(0.8); }
    }

    .grade-label {
      font-weight: 700;
      color: #10b981;
      letter-spacing: 0.1em;
    }

    .hook-statement {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 1.5rem;
      background: rgba(255, 255, 255, 0.12);
      padding: 2rem 2.5rem;
      border-radius: 1.5rem;
      backdrop-filter: blur(15px);
      border: 1px solid rgba(255, 255, 255, 0.2);
      margin-top: 2rem;
      max-width: 700px;
      margin-left: auto;
      margin-right: auto;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
    }

    .hook-icon {
      background: linear-gradient(135deg, #fbbf24, #f59e0b);
      width: 3rem;
      height: 3rem;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.5rem;
      color: white;
      flex-shrink: 0;
      animation: icon-glow 3s ease-in-out infinite;
    }

    @keyframes icon-glow {
      0%, 100% { 
        box-shadow: 0 0 20px rgba(251, 191, 36, 0.3);
        transform: scale(1);
      }
      50% { 
        box-shadow: 0 0 30px rgba(251, 191, 36, 0.6);
        transform: scale(1.05);
      }
    }

    .hook-text {
      font-size: 1.1rem;
      line-height: 1.6;
      color: rgba(255, 255, 255, 0.95);
      margin: 0;
      font-weight: 400;
    }

    /* Enhanced floating animation */
    @keyframes float {
      0%, 100% { transform: translateY(0px) rotate(0deg); }
      33% { transform: translateY(-10px) rotate(1deg); }
      66% { transform: translateY(-5px) rotate(-1deg); }
    }

    /* Responsive adjustments */
    @media (max-width: 768px) {
      .animated-stats {
        flex-direction: column;
        gap: 2rem;
      }
      
      .hook-statement {
        flex-direction: column;
        text-align: center;
      }
      
      .attention-grabber {
        gap: 1.5rem;
      }
      
      .floating-question {
        padding: 1rem 1.5rem;
      }
      
      .question-text {
        font-size: 1rem;
      }
    }

    /* Section Styling */
    .section {
      padding: 4rem 0;
      position: relative;
    }

    .section-header {
      text-align: center;
      margin-bottom: 3rem;
    }

    .section-title {
      font-size: 2.5rem;
      margin-top: 2.5rem;
      margin-bottom: 1rem;
      background: var(--gradient-main);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .section-subtitle {
      font-size: 1.125rem;
      color: var(--text-muted);
      max-width: 600px;
      margin: 0 auto;
    }

    /* Metrics Grid */
    .metrics-grid {
      display: grid;
      grid-template-columns: repeat(2, max-content);
      gap: 3rem;
      margin-top: 3rem;
      margin-bottom: 3rem;
      justify-content: center;
      margin-left: auto;
      margin-right: auto;
    }

    .metric-card {
      background: white;
      border-radius: 1rem;
      padding: 2rem;
      box-shadow: var(--shadow-md);
      border: 1px solid var(--border);
      transition: all 0.3s ease;
      cursor: pointer;
    }

    .metric-card:hover {
      transform: translateY(-4px);
      box-shadow: var(--shadow-lg);
    }

    .metric-icon {
      width: 3rem;
      height: 3rem;
      border-radius: 0.75rem;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.5rem;
      margin-bottom: 1rem;
    }

    .metric-card[data-metric="hr"] .metric-icon {
      background: linear-gradient(135deg, #fee2e2, #fca5a5);
      color: var(--accent-red);
    }

    .metric-card[data-metric="eda"] .metric-icon {
      background: linear-gradient(135deg, #dbeafe, #93c5fd);
      color: var(--accent-blue);
    }

    .metric-card[data-metric="temp"] .metric-icon {
      background: linear-gradient(135deg, #fef3c7, #fcd34d);
      color: var(--accent-yellow);
    }

    .metric-card[data-metric="acc"] .metric-icon {
      background: linear-gradient(135deg, #d1fae5, #6ee7b7);
      color: var(--accent-green);
    }

    .metric-title {
      font-size: 1.125rem;
      font-weight: 600;
      margin-bottom: 0.5rem;
    }

    .metric-description {
      color: var(--text-muted);
      font-size: 0.875rem;
    }

    /* Witeup Section */
    .analysis-writeup {
      background: linear-gradient(135deg, #f8fafc, #f1f5f9);
      border-radius: 1rem;
      padding: 2.5rem;
      margin-top: 2rem;
      border: 1px solid var(--border);
      box-shadow: var(--shadow-md);
    }

    .writeup-title {
      font-size: 1.5rem;
      font-weight: 600;
      color: var(--text-dark);
      margin-bottom: 1.5rem;
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }

    .writeup-content {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 2rem;
    }

    .writeup-section h4 {
      font-size: 1.125rem;
      font-weight: 600;
      color: var(--accent-purple);
      margin-bottom: 1rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .writeup-section p {
      color: var(--text-muted);
      line-height: 1.7;
      margin-bottom: 1rem;
    }

    .key-findings {
      background: white;
      border-radius: 0.75rem;
      padding: 1.5rem;
      border-left: 4px solid var(--accent-blue);
    }

    .clinical-relevance {
      background: white;
      border-radius: 0.75rem;
      padding: 1.5rem;
      border-left: 4px solid var(--accent-green);
    }

    @media (max-width: 768px) {
      .writeup-content {
        grid-template-columns: 1fr;
      }
    }

    /* Visualization Container */
    .viz-container {
      background: white;
      border-radius: 1rem;
      box-shadow: var(--shadow-lg);
      overflow: hidden;
      margin: 2rem 0;
    }

    .viz-header {
      background: var(--gradient-main);
      color: white;
      padding: 1.5rem 2rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .viz-title {
      font-size: 1.5rem;
      font-weight: 600;
    }

    .viz-controls {
      display: flex;
      gap: 0.5rem;
    }

    .control-btn {
      background: var(--glass-bg);
      border: 1px solid var(--glass-border);
      color: white;
      padding: 0.5rem 1rem;
      border-radius: 0.5rem;
      cursor: pointer;
      transition: all 0.3s ease;
      font-size: 0.875rem;
    }

    .control-btn:hover {
      background: rgba(255, 255, 255, 0.2);
    }

    .viz-content {
      display: flex;
      min-height: 700px;
    }

    .chart-panel {
      flex: 2.5;
      padding: 2rem 2rem 2rem 3rem;
      position: relative;
    }

    .details-panel {
      flex: 1;
      background: #f8fafc;
      border-left: 1px solid var(--border);
      padding: 2rem 2rem 2rem 1.5rem;
      display: flex;
      flex-direction: column;
      gap: 1rem;
      overflow-y: auto;
    }

    .time-series-container {
      width: 100%;
      height: 220px;
      border-radius: 0.5rem;
      background: #f1f5f9;
      border: 1px solid var(--border);
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .student-card {
      background: white;
      border-radius: 0.75rem;
      padding: 1.5rem;
      box-shadow: var(--shadow-sm);
      border: 1px solid var(--border);
    }

    .student-name {
      font-weight: 600;
      color: var(--accent-purple);
      margin-bottom: 1rem;
    }

    .time-series-container {
      width: 100%;
      height: 200px;
      border-radius: 0.5rem;
      background: #f1f5f9;
      border: 1px solid var(--border);
    }

    .instructions {
      background: linear-gradient(135deg, #ede9fe, #ddd6fe);
      border: 1px solid #c4b5fd;
      border-radius: 0.75rem;
      padding: 1rem;
      margin-bottom: 1rem;
    }

    .instructions-title {
      font-weight: 600;
      color: var(--accent-purple);
      margin-bottom: 0.5rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .instructions-text {
      font-size: 0.875rem;
      color: var(--text-muted);
    }

    .feedback-box {
      padding: 1rem;
      border-radius: 0.75rem;
      margin-top: 1rem;
      font-weight: 500;
      text-align: center;
      display: none;
    }

    .feedback-box.success {
      background: #d1fae5;
      color: #065f46;
      border: 1px solid #a7f3d0;
    }

    .feedback-box.info {
      background: #dbeafe;
      color: #1e40af;
      border: 1px solid #93c5fd;
    }

    /* Navigation */
    .slide-nav {
      position: fixed;
      bottom: 2rem;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      align-items: center;
      gap: 1rem;
      background: white;
      padding: 0.75rem 1.5rem;
      border-radius: 2rem;
      box-shadow: var(--shadow-lg);
      border: 1px solid var(--border);
      z-index: 1000;
    }

    .nav-btn {
      width: 2.5rem;
      height: 2.5rem;
      border: none;
      border-radius: 50%;
      background: var(--gradient-main);
      color: white;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s ease;
    }

    .nav-btn:hover:not(:disabled) {
      transform: scale(1.1);
    }

    .nav-btn:disabled {
      background: var(--border);
      cursor: not-allowed;
    }

    .slide-counter {
      font-weight: 600;
      color: var(--text-dark);
      font-feature-settings: 'tnum';
    }

    /* Tooltip */
    .tooltip {
      position: absolute;
      background: var(--primary);
      color: white;
      padding: 0.75rem;
      border-radius: 0.5rem;
      font-size: 0.875rem;
      pointer-events: none;
      opacity: 0;
      transition: opacity 0.3s ease;
      z-index: 1000;
      box-shadow: var(--shadow-lg);
      max-width: 200px;
    }

    .tooltip::before {
      content: '';
      position: absolute;
      bottom: -4px;
      left: 50%;
      transform: translateX(-50%);
      width: 0;
      height: 0;
      border-left: 4px solid transparent;
      border-right: 4px solid transparent;
      border-top: 4px solid var(--primary);
    }

    /* Slides */
    .slide {
      display: none;
      min-height: 100vh;
      padding-top: 4rem;
      overflow-y: auto;
      position: relative;
    }

    .slide.active {
      display: block;
      animation: slideIn 0.5s ease-out;
    }

    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* Chart specific styles */
    .legend-item {
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .legend-item:hover {
      opacity: 0.8;
    }

    .draw-overlay {
      cursor: crosshair;
      pointer-events: all;
    }

    .draw-overlay:hover {
      stroke: var(--accent-blue);
      stroke-width: 1;
      stroke-dasharray: 5,5;
      opacity: 0.1;
      fill: var(--accent-blue);
    }

    .user-line {
      stroke: var(--accent-blue);
      stroke-width: 3;
      stroke-linecap: round;
      pointer-events: none;
      opacity: 0.8;
    }

    .best-fit-line {
      stroke: var(--accent-red);
      stroke-width: 3;
      stroke-dasharray: 5,5;
      stroke-linecap: round;
    }

    .dot {
      cursor: pointer;
      transition: all 0.3s ease;
      filter: drop-shadow(0 2px 4px rgba(0,0,0,0.1));
    }

    .dot:hover {
      stroke-width: 2;
      filter: drop-shadow(0 4px 8px rgba(0,0,0,0.2));
    }

    .gridlines {
      opacity: 0.3;
    }

    .gridlines line {
      stroke: var(--border);
      stroke-dasharray: 2,2;
    }

    /* Responsive */
    @media (max-width: 768px) {
      .hero-title {
        font-size: 2.5rem;
      }
      
      .viz-content {
        flex-direction: column;
      }
      
      .details-panel {
        border-left: none;
        border-top: 1px solid var(--border);
      }
      
      .nav-progress {
        display: none;
      }
      
      .metrics-grid {
        grid-template-columns: 1fr;
      }
    }

    /* Modal styles */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.8);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 2000;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s ease;
    }

    .modal-overlay.show {
      opacity: 1;
      pointer-events: all;
    }

    .modal-content {
      background: white;
      border-radius: 1rem;
      max-width: 90vw;
      max-height: 90vh;
      width: 800px;
      height: 600px;
      overflow: hidden;
      box-shadow: var(--shadow-lg);
      transform: scale(0.9);
      transition: transform 0.3s ease;
      display: flex;
      flex-direction: column;
    }

    .modal-overlay.show .modal-content {
      transform: scale(1);
    }

    .modal-header {
      background: var(--gradient-main);
      color: white;
      padding: 1.5rem 2rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .modal-title {
      font-size: 1.5rem;
      font-weight: 600;
      margin: 0;
    }

    .modal-close {
      background: none;
      border: none;
      color: white;
      font-size: 1.5rem;
      cursor: pointer;
      padding: 0.5rem;
      border-radius: 0.5rem;
      transition: background-color 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      width: 2.5rem;
      height: 2.5rem;
    }

    .modal-close:hover {
      background: rgba(255, 255, 255, 0.2);
    }

    .modal-body {
      flex: 1;
      padding: 2rem;
      overflow: auto;
    }

    .enlarged-chart {
      width: 2000%;
      height: 100%;
      min-height: 400px;
      margin-inline: auto;
    }

    .student-details {
      display: grid;
      grid-template-columns: 1fr 200px;
      gap: 2rem;
      height: 100%;
    }

    .chart-section {
      display: flex;
      flex-direction: column;
    }

    .stats-section {
      background: var(--primary-light);
      border-radius: 0.75rem;
      padding: 1.5rem;
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }

    .stat-item {
      background: white;
      border-radius: 0.5rem;
      padding: 1rem;
      box-shadow: var(--shadow-sm);
      border: 1px solid var(--border);
    }

    .stat-label {
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      margin-bottom: 0.25rem;
    }

    .stat-value {
      font-size: 1.25rem;
      font-weight: 600;
      color: var(--text-dark);
    }

    .time-series-container {
      width: 100%;
      height: 200px;
      border-radius: 0.5rem;
      background: #f1f5f9;
      border: 1px solid var(--border);
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .time-series-container:hover {
      transform: scale(1.02);
      box-shadow: var(--shadow-md);
      border-color: var(--accent-purple);
    }

    .expand-hint {
      position: absolute;
      bottom: 0.5rem;
      right: 0.5rem;
      background: var(--accent-purple);
      color: white;
      padding: 0.25rem 0.5rem;
      border-radius: 0.25rem;
      font-size: 0.75rem;
      opacity: 0;
      transition: opacity 0.3s ease;
      pointer-events: none;
    }

    .time-series-container:hover .expand-hint {
      opacity: 1;
    }
    .annotations circle {
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .annotations text {
      pointer-events: none;
      text-shadow: 0 0 3px white, 0 0 3px white, 0 0 3px white;
    }

    .annotations line {
      pointer-events: none;
    }
    .loading {
      display: flex;
      align-items: center;
      justify-content: center;
      height: 400px;
      color: var(--text-muted);
    }

    .spinner {
      border: 3px solid var(--border);
      border-top: 3px solid var(--accent-purple);
      border-radius: 50%;
      width: 2rem;
      height: 2rem;
      animation: spin 1s linear infinite;
      margin-right: 0.75rem;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    /* Header improvements */
    .header-content {
      display: flex;
      justify-content: center;
      align-items: center;
      position: relative;
      min-height: 80px;
    }

    .logo {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 0.5rem;
      text-align: center;
    }

    .logo-subtitle {
      font-size: 0.875rem;
      opacity: 0.8;
      font-weight: 400;
      font-style: italic;
    }

    .header-decoration-left,
    .header-decoration-right {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      display: flex;
      gap: 1rem;
    }

    .header-decoration-left {
      left: 2rem;
    }

    .header-decoration-right {
      right: 2rem;
    }

    .floating-icon {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: var(--glass-bg);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.25rem;
      border: 1px solid var(--glass-border);
      animation: float 3s ease-in-out infinite;
    }

    .floating-icon.delay-1 {
      animation-delay: 0.5s;
    }

    .floating-icon.delay-2 {
      animation-delay: 1s;
    }

    .floating-icon.delay-3 {
      animation-delay: 1.5s;
    }

    @keyframes float {
      0%, 100% { transform: translateY(0px); }
      50% { transform: translateY(-10px); }
    }

    @media (max-width: 768px) {
      .header-decoration-left,
      .header-decoration-right {
        display: none;
      }
    }

    /* Brain Model */
    .interactive-demo {
      margin-top: 3rem;
      display: flex;
      justify-content: center;
    }

    .brain-model {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 1rem;
    }

    .brain-container {
      position: relative;
      width: 120px;
      height: 80px;
      display: flex;
      perspective: 1000px;
    }

    .brain-hemisphere {
      width: 60px;
      height: 80px;
      background: linear-gradient(135deg, #8b5cf6, #6366f1);
      position: relative;
      border-radius: 50px 10px 10px 50px;
      box-shadow: inset 0 4px 8px rgba(0, 0, 0, 0.2);
      overflow: hidden;
    }

    .brain-right {
      border-radius: 10px 50px 50px 10px;
      background: linear-gradient(135deg, #6366f1, #3b82f6);
    }

    .neural-activity {
      position: absolute;
      width: 8px;
      height: 8px;
      background: #fbbf24;
      border-radius: 50%;
      animation: neural-pulse 2s ease-in-out infinite;
      box-shadow: 0 0 10px #fbbf24;
    }

    .brain-left .neural-activity:nth-child(1) { top: 20%; left: 30%; }
    .brain-left .neural-activity:nth-child(2) { top: 50%; left: 60%; }
    .brain-left .neural-activity:nth-child(3) { top: 70%; left: 40%; }

    .brain-right .neural-activity:nth-child(1) { top: 30%; right: 30%; }
    .brain-right .neural-activity:nth-child(2) { top: 60%; right: 50%; }
    .brain-right .neural-activity:nth-child(3) { top: 80%; right: 35%; }

    @keyframes neural-pulse {
      0%, 100% { 
        opacity: 0.3;
        transform: scale(1);
      }
      50% { 
        opacity: 1;
        transform: scale(1.5);
      }
    }

    .brain-caption {
      font-size: 0.9rem;
      color: rgba(255, 255, 255, 0.8);
      text-align: center;
      font-weight: 500;
    }

    /* Fun Facts Grid */
    .fun-facts-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 1.5rem;
      margin: 5rem 0 3rem 0;
      max-width: 800px;
      margin-left: auto;
      margin-right: auto;
      padding-top: 8rem;
    }

    @media (max-width: 768px) {
      .fun-facts-grid {
        grid-template-columns: 1fr;
        gap: 1rem;
      }
    }

    @media (min-width: 1200px) {
      .fun-facts-grid {
        grid-template-columns: repeat(4, 1fr);
        max-width: 1000px;
      }
    }

    .fun-fact-card {
      background: rgba(255, 255, 255, 0.12);
      backdrop-filter: blur(15px);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 1rem;
      padding: 1.5rem;
      display: flex;
      align-items: center;
      gap: 1rem;
      animation: slideInFromBottom 0.8s ease-out forwards;
      opacity: 0;
      transform: translateY(30px);
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
      transition: all 0.3s ease;
    }

    .fun-fact-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15);
      background: rgba(255, 255, 255, 0.18);
    }

    @keyframes slideInFromBottom {
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .fact-icon {
      background: linear-gradient(135deg, #fbbf24, #f59e0b);
      width: 3rem;
      height: 3rem;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.5rem;
      color: white;
      flex-shrink: 0;
      animation: icon-pulse 3s ease-in-out infinite;
    }

    @keyframes icon-pulse {
      0%, 100% { 
        box-shadow: 0 0 20px rgba(251, 191, 36, 0.3);
        transform: scale(1);
      }
      50% { 
        box-shadow: 0 0 30px rgba(251, 191, 36, 0.6);
        transform: scale(1.05);
      }
    }

    .fact-content {
      flex: 1;
    }

    .fact-number {
      font-size: 1.8rem;
      font-weight: 900;
      color: linear-gradient(35deg, var(--accent-red), var(--accent-yellow));
      line-height: 1;
      margin-bottom: 0.25rem;
      background: linear-gradient(135deg, #ffffff, #e2e8f0);
      background-clip: text;
    }

    .fact-text {
      font-size: 0.9rem;
      color: rgba(189, 159, 87, 0.9);
      font-weight: 500;
    }

    /* Correlation Analysis Styles */
    .correlation-container {
      background: white;
      border-radius: 1rem;
      padding: 2.5rem;
      margin: 2rem 0;
      box-shadow: var(--shadow-lg);
      border: 1px solid var(--border);
    }

    .correlation-title {
      font-size: 1.5rem;
      font-weight: 600;
      color: var(--text-dark);
      margin-bottom: 2rem;
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }

    .correlation-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 1.5rem;
      margin-bottom: 2rem;
    }

    .correlation-card {
      background: var(--primary-light);
      border-radius: 0.75rem;
      padding: 1.5rem;
      border: 1px solid var(--border);
      transition: all 0.3s ease;
    }

    .correlation-card:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-md);
    }

    .correlation-header {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      margin-bottom: 1rem;
      font-weight: 600;
      color: var(--text-dark);
    }

    .correlation-header i {
      font-size: 1.25rem;
    }

    .correlation-bar {
      background: #e2e8f0;
      height: 8px;
      border-radius: 4px;
      margin: 1rem 0;
      position: relative;
      overflow: hidden;
    }

    .correlation-fill {
      height: 100%;
      border-radius: 4px;
      transition: width 2s ease-out;
      animation: fillBar 2s ease-out;
    }

    .correlation-fill.negative {
      margin-left: auto;
    }

    @keyframes fillBar {
      from { width: 0; }
    }

    .correlation-value {
      font-size: 1.25rem;
      font-weight: 700;
      color: var(--text-dark);
      margin-bottom: 0.25rem;
    }

    .correlation-desc {
      font-size: 0.875rem;
      color: var(--text-muted);
    }

    /* Insights Grid */
    .insights-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 2rem;
      margin: 2rem 0;
      justify-items: center;
    }

    .insights-grid .insight-card:nth-child(4) {
      grid-column: 1 / -1;
      max-width: 400px;
      width: 100%;
    }

    .insight-card {
      background: white;
      border-radius: 1rem;
      padding: 2rem;
      box-shadow: var(--shadow-md);
      border: 1px solid var(--border);
      transition: all 0.3s ease;
    }

    .insight-card:hover {
      transform: translateY(-4px);
      box-shadow: var(--shadow-lg);
    }

    .insight-icon {
      width: 3rem;
      height: 3rem;
      border-radius: 0.75rem;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.5rem;
      margin-bottom: 1rem;
    }

    .insight-title {
      font-size: 1.125rem;
      font-weight: 600;
      margin-bottom: 0.5rem;
      color: var(--text-dark);
    }

    .insight-description {
      color: var(--text-muted);
      font-size: 0.875rem;
      line-height: 1.6;
    }

    /* Statistical Summary */
    .stats-summary {
      background: linear-gradient(135deg, #f8fafc, #f1f5f9);
      border-radius: 1rem;
      padding: 2.5rem;
      margin-top: 2rem;
      border: 1px solid var(--border);
      box-shadow: var(--shadow-md);
    }

    .stats-title {
      font-size: 1.5rem;
      font-weight: 600;
      color: var(--text-dark);
      margin-bottom: 1.5rem;
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }

    .stats-content {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 2rem;
    }

    .stats-column h4 {
      font-size: 1.125rem;
      font-weight: 600;
      color: var(--accent-purple);
      margin-bottom: 1rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .stats-column ul {
      list-style: none;
      padding: 0;
    }

    .stats-column li {
      color: var(--text-muted);
      line-height: 1.7;
      margin-bottom: 0.5rem;
      padding-left: 1rem;
      position: relative;
    }

    .stats-column li::before {
      content: '•';
      color: var(--accent-purple);
      font-weight: bold;
      position: absolute;
      left: 0;
    }

    /* Next Page Annotation */
    .next-page-hint {
      position: fixed;
      bottom: 120px;
      right: 2rem;
      background: rgba(139, 92, 246, 0.9);
      color: white;
      padding: 1rem 1.5rem;
      border-radius: 2rem;
      font-size: 0.875rem;
      font-weight: 500;
      z-index: 999;
      animation: pulseHint 2s ease-in-out infinite;
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.2);
      box-shadow: 0 8px 32px rgba(139, 92, 246, 0.3);
      display: flex;
      align-items: center;
      gap: 0.5rem;
      opacity: 0;
      animation: slideInHint 1s ease-out 3s forwards, pulseHint 2s ease-in-out 4s infinite;
    }

    .next-page-hint.hidden {
      display: none;
    }

    .next-page-hint i {
      font-size: 1rem;
    }

    @keyframes slideInHint {
      from {
        opacity: 0;
        transform: translateX(100px);
      }
      to {
        opacity: 1;
        transform: translateX(0);
      }
    }

    @keyframes pulseHint {
      0%, 100% {
        transform: scale(1);
        box-shadow: 0 8px 32px rgba(139, 92, 246, 0.3);
      }
      50% {
        transform: scale(1.05);
        box-shadow: 0 12px 40px rgba(139, 92, 246, 0.5);
      }
    }

    /* Scroll hint */
    .scroll-hint {
      position: fixed;
      bottom: 180px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(255, 255, 255, 0.9);
      color: var(--text-dark);
      padding: 0.75rem 1.25rem;
      border-radius: 1.5rem;
      font-size: 0.8rem;
      font-weight: 500;
      z-index: 999;
      backdrop-filter: blur(10px);
      border: 1px solid rgba(0, 0, 0, 0.1);
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
      display: flex;
      align-items: center;
      gap: 0.5rem;
      opacity: 0;
      animation: slideInHint 1s ease-out 4s forwards, fadeOutHint 1s ease-out 8s forwards;
    }

    .scroll-hint.hidden {
      display: none;
    }

    @keyframes fadeOutHint {
      from { opacity: 1; }
      to { opacity: 0; }
    }

    @media (max-width: 768px) {
      .next-page-hint {
        bottom: 100px;
        right: 1rem;
        padding: 0.75rem 1.25rem;
        font-size: 0.8rem;
      }
      
      .scroll-hint {
        bottom: 160px;
        padding: 0.5rem 1rem;
        font-size: 0.75rem;
      }
    }

    /* Story-telling Summary */
    .story-summary {
      background: linear-gradient(135deg, #fefefe, #f8fafc);
      border-radius: 1.5rem;
      padding: 3rem;
      margin: 3rem 0 2rem 0;
      border: 1px solid #e2e8f0;
      box-shadow: var(--shadow-lg);
      position: relative;
      overflow: hidden;
    }

    .story-summary::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: var(--gradient-main);
    }

    .story-title {
      font-size: 1.8rem;
      font-weight: 700;
      color: var(--text-dark);
      margin-bottom: 0.5rem;
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .story-subtitle {
      font-size: 1.4rem;
      font-weight: 600;
      color: var(--accent-purple);
      margin-bottom: 2rem;
      line-height: 1.4;
      font-style: italic;
    }

    .story-section {
      margin-bottom: 2.5rem;
    }

    .story-section:last-child {
      margin-bottom: 1.5rem;
    }

    .story-section-title {
      font-size: 1.3rem;
      font-weight: 700;
      color: var(--accent-blue);
      margin-bottom: 1rem;
      position: relative;
      padding-left: 1.5rem;
    }

    .story-section-title::before {
      content: '📊';
      position: absolute;
      left: 0;
      top: 0;
      font-size: 1.2rem;
    }

    .story-section-title:nth-of-type(1)::before { content: '💗'; }
    .story-section-title:nth-of-type(2)::before { content: '💧'; }
    .story-section-title:nth-of-type(3)::before { content: '🌡️'; }
    .story-section-title:nth-of-type(4)::before { content: '🏃'; }

    .story-text {
      color: var(--text-dark);
      line-height: 1.8;
      font-size: 1.05rem;
      margin-bottom: 1.2rem;
      text-align: justify;
    }

    .story-highlight {
      background: linear-gradient(120deg, rgba(139, 92, 246, 0.1) 0%, rgba(139, 92, 246, 0.05) 100%);
      padding: 0.2em 0.4em;
      border-radius: 0.3rem;
      font-weight: 600;
      color: var(--accent-purple);
    }

    .story-summary-section {
      background: linear-gradient(135deg, #f0f9ff, #e0f2fe);
      border-radius: 1rem;
      padding: 2rem;
      margin-top: 2rem;
      border-left: 4px solid var(--accent-blue);
    }

    .story-summary-title {
      font-size: 1.2rem;
      font-weight: 700;
      color: var(--accent-blue);
      margin-bottom: 1rem;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    .story-quote {
      background: rgba(255, 255, 255, 0.7);
      border-left: 4px solid var(--accent-purple);
      padding: 1.5rem;
      margin: 1.5rem 0;
      border-radius: 0 0.5rem 0.5rem 0;
      font-style: italic;
      color: var(--text-muted);
      position: relative;
    }

    .story-quote::before {
      content: '"';
      font-size: 3rem;
      color: var(--accent-purple);
      position: absolute;
      top: -0.5rem;
      left: 1rem;
      opacity: 0.3;
      font-family: 'Playfair Display', serif;
    }

    @media (max-width: 768px) {
      .story-summary {
        padding: 2rem;
        margin: 2rem 0;
      }
      
      .story-title {
        font-size: 1.5rem;
      }
      
      .story-subtitle {
        font-size: 1.2rem;
      }
      
      .story-section-title {
        font-size: 1.1rem;
      }
      
      .story-text {
        font-size: 1rem;
      }
    }
  </style>
</head>

<body>
  <header>
    <div class="container">
      <div class="header-content">
        <div class="header-decoration-left">
          <div class="floating-icon">
            <i class="fas fa-brain"></i>
          </div>
          <div class="floating-icon delay-1">
            <i class="fas fa-chart-line"></i>
          </div>
        </div>
        
        <div class="logo">
          <div class="logo-icon">
            <i class="fas fa-heartbeat"></i>
          </div>
          <div class="logo-text">Academic Stress Analytics</div>
          <div class="logo-subtitle">Physiological Insights for Educational Excellence</div>
        </div>
        
        <div class="header-decoration-right">
          <div class="floating-icon delay-2">
            <i class="fas fa-microscope"></i>
          </div>
          <div class="floating-icon delay-3">
            <i class="fas fa-graduation-cap"></i>
          </div>
        </div>
      </div>
    </div>
  </header>

  <!-- Modal for enlarged student data -->
  <div class="modal-overlay" id="studentModal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title" id="modalTitle">Student Data Analysis</h3>
        <button class="modal-close" onclick="closeStudentModal()">
          <i class="fas fa-times"></i>
        </button>
      </div>
      <div class="modal-body">
        <div class="student-details">
          <div class="chart-section">
            <svg class="enlarged-chart" id="enlargedChart"></svg>
          </div>
          <div class="stats-section">
            <div class="stat-item">
              <div class="stat-label">Average Value</div>
              <div class="stat-value" id="avgValue">--</div>
            </div>
            <div class="stat-item">
              <div class="stat-label">Peak Value</div>
              <div class="stat-value" id="peakValue">--</div>
            </div>
            <div class="stat-item">
              <div class="stat-label">Min Value</div>
              <div class="stat-value" id="minValue">--</div>
            </div>
            <div class="stat-item">
              <div class="stat-label">Stress Increase</div>
              <div class="stat-value" id="stressIncrease">--</div>
            </div>
            <div class="stat-item">
              <div class="stat-label">Recovery Rate</div>
              <div class="stat-value" id="recoveryRate">--</div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Navigation -->
  <div class="slide-nav">
    <button class="nav-btn" id="prevBtn" onclick="changeSlide(-1)">
      <i class="fas fa-chevron-left"></i>
    </button>
    <div class="slide-counter">
    <span id="currentSlide">1</span> / <span id="totalSlides">7</span>
    </div>
    <button class="nav-btn" id="nextBtn" onclick="changeSlide(1)">
      <i class="fas fa-chevron-right"></i>
    </button>
  </div>

  <!-- Tooltip -->
  <div class="tooltip"></div>

  <script>
    // Global state
    let currentSlide = 0;
    const totalSlides = 7;
    let visualizations = {
      HR: null,
      EDA: null,
      TEMP: null,
      ACC: null
    };

    // Global state for modal
    let currentStudentData = null;
    let currentMetric = null;

    // Modal functions
    function openStudentModal(studentData, metric) {
      try {
        currentStudentData = studentData;
        currentMetric = metric;
        
        const modal = document.getElementById('studentModal');
        const modalTitle = document.getElementById('modalTitle');
        
        if (modalTitle) {
          modalTitle.textContent = `Student ${studentData.student} - ${studentData.test} (${metric})`;
        }
        
        // Generate enlarged chart
        createEnlargedChart(studentData, metric);
        updateStudentStats(studentData, metric);
        
        if (modal) {
          modal.classList.add('show');
          document.body.style.overflow = 'hidden';
        }
      } catch (error) {
        console.error('Error opening student modal:', error);
      }
    }

    function closeStudentModal() {
      try {
        const modal = document.getElementById('studentModal');
        if (modal) {
          modal.classList.remove('show');
        }
        document.body.style.overflow = '';
        
        // Clear the enlarged chart
        d3.select('#enlargedChart').selectAll('*').remove();
      } catch (error) {
        console.error('Error closing student modal:', error);
      }
    }

    async function createEnlargedChart(studentData, metric) {
      const svg = d3.select('#enlargedChart');
      svg.selectAll('*').remove();

      const data = await generateTimeSeriesData(studentData.student, studentData.test, metric);
      const minMaxData = await generateMinMaxData(studentData.test, metric);
      const interestingMoments = findInterestingMoments(data, metric);
      
      const width = 500;
      const height = 400;
      const margin = { top: 40, right: 40, bottom: 60, left: 80 };

      const xScale = d3.scaleLinear()
        .domain(d3.extent(data, d => d.time_seconds))
        .range([margin.left, width - margin.right]);

      const yScale = d3.scaleLinear()
        .domain([
          Math.min(d3.min(data, d => d[metric]), d3.min(minMaxData, d => d[`${metric}_min`])),
          Math.max(d3.max(data, d => d[metric]), d3.max(minMaxData, d => d[`${metric}_max`]))
        ])
        .range([height - margin.bottom, margin.top])
        .nice();

      const line = d3.line()
        .x(d => xScale(d.time_seconds))
        .y(d => yScale(d[metric]))
        .curve(d3.curveMonotoneX);

      // Create area for min/max envelope
      const area = d3.area()
        .x(d => xScale(d.time_seconds))
        .y0(d => yScale(d[`${metric}_min`]))
        .y1(d => yScale(d[`${metric}_max`]))
        .curve(d3.curveMonotoneX);

      const colorScale = d3.scaleOrdinal()
        .domain(['pre-test', 'in-test', 'post-test'])
        .range(['var(--pre-test)', 'var(--in-test)', 'var(--post-test)']);

      // Add background periods with labels
      let periods = [
        { name: 'pre-test', start: -300, end: 0, label: 'Pre-Test' },
        { name: 'in-test', start: 0, end: 5400, label: 'During Test' },
        { name: 'post-test', start: 5400, end: 5700, label: 'Post-Test' }
      ];
      if (studentData.test === 'Final') {
        periods = [
          { name: 'pre-test', start: -300, end: 0, label: 'Pre-Test' },
          { name: 'in-test', start: 0, end: 10800, label: 'During Test' },
          { name: 'post-test', start: 10800, end: 11100, label: 'Post-Test' }
        ];
      }

      periods.forEach(period => {
        svg.append('rect')
          .attr('x', xScale(period.start))
          .attr('y', margin.top)
          .attr('width', xScale(period.end) - xScale(period.start))
          .attr('height', height - margin.top - margin.bottom)
          .attr('fill', colorScale(period.name))
          .attr('opacity', 0.1);

        // Add period labels
        svg.append('text')
          .attr('x', xScale((period.start + period.end) / 2))
          .attr('y', margin.top - 10)
          .attr('text-anchor', 'middle')
          .style('font-size', '12px')
          .style('font-weight', '600')
          .style('fill', colorScale(period.name))
          .text(period.label);
      });

      // Add gridlines
      svg.append('g')
        .attr('class', 'gridlines')
        .attr('transform', `translate(0,${height - margin.bottom})`)
        .call(d3.axisBottom(xScale).tickSize(-height + margin.top + margin.bottom).tickFormat(''));

      svg.append('g')
        .attr('class', 'gridlines')
        .attr('transform', `translate(${margin.left},0)`)
        .call(d3.axisLeft(yScale).tickSize(-width + margin.left + margin.right).tickFormat(''));

      // Add min/max area
      svg.append('path')
        .datum(minMaxData)
        .attr('fill', '#9ca3af')
        .attr('fill-opacity', 0.2)
        .attr('stroke', 'none')
        .attr('d', area);

      // Add boundary lines
      svg.append('path')
        .datum(minMaxData)
        .attr('fill', 'none')
        .attr('stroke', '#9ca3af')
        .attr('stroke-width', 1.5)
        .attr('stroke-dasharray', '3,3')
        .attr('d', d3.line()
          .x(d => xScale(d.time_seconds))
          .y(d => yScale(d[`${metric}_min`]))
          .curve(d3.curveMonotoneX)
        );

      svg.append('path')
        .datum(minMaxData)
        .attr('fill', 'none')
        .attr('stroke', '#9ca3af')
        .attr('stroke-width', 1.5)
        .attr('stroke-dasharray', '3,3')
        .attr('d', d3.line()
          .x(d => xScale(d.time_seconds))
          .y(d => yScale(d[`${metric}_max`]))
          .curve(d3.curveMonotoneX)
        );

      // Add student's data line
      svg.append('path')
        .datum(data)
        .attr('fill', 'none')
        .attr('stroke', 'var(--accent-purple)')
        .attr('stroke-width', 3)
        .attr('d', line);

      // Add data points
      svg.selectAll('.data-point')
        .data(data.filter((d, i) => i % 5 === 0)) // Subsample for clarity
        .enter().append('circle')
        .attr('class', 'data-point')
        .attr('cx', d => xScale(d.time_seconds))
        .attr('cy', d => yScale(d[metric]))
        .attr('r', 3)
        .attr('fill', 'var(--accent-purple)')
        .attr('stroke', 'white')
        .attr('stroke-width', 1)
        .style('opacity', 0.8);

      // Add enhanced annotations
      const annotationGroup = svg.append('g').attr('class', 'annotations');

      interestingMoments.forEach((moment, i) => {
        const x = xScale(moment.time);
        const y = yScale(moment.value);

        // Add annotation point
        annotationGroup.append('circle')
          .attr('cx', x)
          .attr('cy', y)
          .attr('r', 6)
          .attr('fill', moment.color)
          .attr('stroke', 'white')
          .attr('stroke-width', 2);

        // Add annotation callout
        const labelOffset = 60;
        const labelX = x + (i % 2 === 0 ? labelOffset : -labelOffset);
        const labelY = y - 20;

        // Callout line
        annotationGroup.append('line')
          .attr('x1', x)
          .attr('y1', y)
          .attr('x2', labelX)
          .attr('y2', labelY)
          .attr('stroke', moment.color)
          .attr('stroke-width', 2);

        // Callout background
        const textGroup = annotationGroup.append('g');
        
        const textBg = textGroup.append('rect')
          .attr('x', labelX - 50)
          .attr('y', labelY - 25)
          .attr('width', 100)
          .attr('height', 35)
          .attr('fill', 'white')
          .attr('stroke', moment.color)
          .attr('stroke-width', 1)
          .attr('rx', 4);

        const textElement = textGroup.append('text')
          .attr('x', labelX)
          .attr('y', labelY - 10)
          .attr('text-anchor', 'middle')
          .style('font-size', '11px')
          .style('font-weight', '600')
          .style('fill', moment.color);

        textElement.append('tspan')
          .attr('x', labelX)
          .text(moment.label);

        textElement.append('tspan')
          .attr('x', labelX)
          .attr('dy', '1.2em')
          .style('font-size', '10px')
          .style('font-weight', '400')
          .text(moment.description.replace(/[()]/g, ''));
      });

      // Add axes
      svg.append('g')
        .attr('transform', `translate(0,${height - margin.bottom})`)
        .call(d3.axisBottom(xScale).ticks(8).tickFormat(d => `${Math.floor(d/60)}:${(d%60).toString().padStart(2,'0')}`))
        .selectAll('text')
        .style('font-size', '12px');

      svg.append('g')
        .attr('transform', `translate(${margin.left},0)`)
        .call(d3.axisLeft(yScale).ticks(8))
        .selectAll('text')
        .style('font-size', '12px');

      // Add axis labels
      svg.append('text')
        .attr('x', width / 2)
        .attr('y', height - 10)
        .attr('text-anchor', 'middle')
        .style('font-size', '14px')
        .style('font-weight', '600')
        .style('fill', 'var(--text-dark)')
        .text('Time (mm:ss)');

      svg.append('text')
        .attr('transform', 'rotate(-90)')
        .attr('y', 20)
        .attr('x', -height / 2)
        .attr('text-anchor', 'middle')
        .style('font-size', '14px')
        .style('font-weight', '600')
        .style('fill', 'var(--text-dark)')
        .text(`${metric} Value`);

      // Add legend
      const legend = svg.append('g')
        .attr('class', 'legend')
        .attr('transform', `translate(${width - 150}, ${margin.top + 10})`);

      const legendItems = [
        { color: 'var(--accent-purple)', label: 'Student Data', type: 'line' },
        { color: '#9ca3af', label: 'Population Range', type: 'area' }
      ];

      legendItems.forEach((item, i) => {
        const legendRow = legend.append('g')
          .attr('transform', `translate(0, ${i * 20})`);

        if (item.type === 'line') {
          legendRow.append('line')
            .attr('x1', 0)
            .attr('x2', 15)
            .attr('y1', 5)
            .attr('y2', 5)
            .attr('stroke', item.color)
            .attr('stroke-width', 3);
        } else {
          legendRow.append('rect')
            .attr('width', 15)
            .attr('height', 10)
            .attr('fill', item.color)
            .attr('fill-opacity', 0.3);
        }

        legendRow.append('text')
          .attr('x', 20)
          .attr('y', 8)
          .style('font-size', '12px')
          .style('fill', 'var(--text-dark)')
          .text(item.label);
      });
    }

    async function updateStudentStats(studentData, metric) {
      try {
        const data = await generateTimeSeriesData(studentData.student, studentData.test, metric);
        const values = data.map(d => d[metric]);
        const inTestData = data.filter(d => d.period === 'in-test');
        const preTestData = data.filter(d => d.period === 'pre-test');
        const postTestData = data.filter(d => d.period === 'post-test');

        const avgValue = d3.mean(values) || 0;
        const peakValue = d3.max(values) || 0;
        const minValue = d3.min(values) || 0;
        
        const preTestAvg = d3.mean(preTestData, d => d[metric]) || 0;
        const inTestAvg = d3.mean(inTestData, d => d[metric]) || 0;
        const postTestAvg = d3.mean(postTestData, d => d[metric]) || 0;
        
        const stressIncrease = inTestAvg - preTestAvg;
        const recoveryRate = postTestAvg - inTestAvg;

        const avgElement = document.getElementById('avgValue');
        const peakElement = document.getElementById('peakValue');
        const minElement = document.getElementById('minValue');
        const stressElement = document.getElementById('stressIncrease');
        const recoveryElement = document.getElementById('recoveryRate');

        if (avgElement) avgElement.textContent = avgValue.toFixed(1);
        if (peakElement) peakElement.textContent = peakValue.toFixed(1);
        if (minElement) minElement.textContent = minValue.toFixed(1);
        if (stressElement) stressElement.textContent = stressIncrease > 0 ? `+${stressIncrease.toFixed(1)}` : stressIncrease.toFixed(1);
        if (recoveryElement) recoveryElement.textContent = recoveryRate > 0 ? `+${recoveryRate.toFixed(1)}` : recoveryRate.toFixed(1);
      } catch (error) {
        console.error('Error updating student stats:', error);
      }
    }

    // Mock data that mimics the original CSV structure
    const gradesData = {
      'S1': { 'Midterm 1': 78, 'Midterm 2': 82, 'Final': 182 },
      'S2': { 'Midterm 1': 82, 'Midterm 2': 85, 'Final': 180 },
      'S3': { 'Midterm 1': 77, 'Midterm 2': 90, 'Final': 188 },
      'S4': { 'Midterm 1': 75, 'Midterm 2': 77, 'Final': 149 },
      'S5': { 'Midterm 1': 67, 'Midterm 2': 77, 'Final': 157 },
      'S6': { 'Midterm 1': 71, 'Midterm 2': 64, 'Final': 175 },
      'S7': { 'Midterm 1': 64, 'Midterm 2': 33, 'Final': 110 },
      'S8': { 'Midterm 1': 92, 'Midterm 2': 88, 'Final': 184 },
      'S9': { 'Midterm 1': 80, 'Midterm 2': 39, 'Final': 126 },
      'S10': { 'Midterm 1': 89, 'Midterm 2': 64, 'Final': 116 }
    };

    // Data loading functions
    async function loadRealData(student, test, metric) {
      try {
        const path = `dataset/S${student}_processed/${test}/${metric}.csv`;
        const response = await fetch(path);
        
        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }
        
        const csvText = await response.text();
        let data = d3.csvParse(csvText, d => ({
          time_seconds: +d.time_seconds,
          [metric]: +d[metric],
          period: d.period ? d.period.trim() : 'unknown',
          timestamp: d.timestamp || ''
        }));
        
        // Significantly reduce ACC data points for faster loading
        if (metric === 'ACC') {
          data = data.filter((_, i) => i % 500 === 0); // Take every 500th point instead of 200th
        }
        if (metric === 'TEMP') {
          data = data.filter((_, i) => i % 20 === 0);
        }
        if (metric === 'EDA') {
          data = data.filter((_, i) => i % 20 === 0);
        }

        return data;
      } catch (error) {
        console.warn(`Failed to load real data for S${student}, ${test}, ${metric}:`, error);
        return null;
      }
    }

    async function loadMinMaxData(test, metric) {
      try {
        const path = `${metric}_min_max_${test}.csv`;
        const response = await fetch(path);
        
        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }
        
        const csvText = await response.text();
        let data = d3.csvParse(csvText, d => ({
          time_seconds: +d.time_seconds,
          [`${metric}_min`]: +d[`${metric}_min`],
          [`${metric}_max`]: +d[`${metric}_max`],
          period: d.period ? d.period.trim() : 'unknown'
        }));

        // Significantly reduce ACC data points for faster loading
        if (metric === 'ACC') {
          data = data.filter((_, i) => i % 500 === 0); // Take every 500th point instead of 200th
        }
        if (metric === 'TEMP') {
          data = data.filter((_, i) => i % 20 === 0);
        }
        if (metric === 'EDA') {
          data = data.filter((_, i) => i % 20 === 0);
        }
        
        return data;
      } catch (error) {
        console.warn(`Failed to load min/max data for ${test}, ${metric}:`, error);
        return null;
      }
    }

    // Data generation functions
    async function generateMetricData(metric) {
      const data = [];
      const studentCount = 10;
      const tests = ['Midterm 1', 'Midterm 2', 'Final'];
      
      for (let student = 1; student <= studentCount; student++) {
        const studentId = `S${student}`;
        const gradeData = gradesData[studentId];
        
        for (const test of tests) {
          // Try to load real data first
          const realData = await loadRealData(student, test, metric);
          
          let avgMetric;
          let score;
          
          if (test === 'Midterm 1') score = gradeData['Midterm 1'];
          else if (test === 'Midterm 2') score = gradeData['Midterm 2'];
          else score = gradeData['Final'] / 2; // Divide final by 2 as in original code
          
          if (realData && realData.length > 0) {
            // Use real data - calculate average for in-test period
            const inTestData = realData.filter(d => d.period === 'in-test');
            if (inTestData.length > 0) {
              avgMetric = d3.mean(inTestData, d => d[metric]);
            } else {
              // Fallback to all data if no in-test period found
              avgMetric = d3.mean(realData, d => d[metric]);
            }
          } 
          else {
            // Generate mock data as fallback
            const baseStress = Math.random() * 0.5 + 0.5;
            const performanceCorrelation = Math.random() * 0.6 - 0.3;
            const normalizedScore = (score - 50) / 50;
            
            switch (metric) {
              case 'HR':
                avgMetric = 70 + baseStress * 25 + performanceCorrelation * normalizedScore * 15;
                break;
              case 'EDA':
                avgMetric = 2 + baseStress * 8 - performanceCorrelation * normalizedScore * 3;
                break;
              case 'TEMP':
                avgMetric = 36.2 + baseStress * 1.5 - performanceCorrelation * normalizedScore * 0.5;
                break;
              case 'ACC':
                avgMetric = 0.1 + baseStress * 0.6 - performanceCorrelation * normalizedScore * 0.2;
                break;
            }
            avgMetric = Math.max(0, avgMetric + (Math.random() - 0.5) * 2);
          }
          
          data.push({
            student: student,
            test: test,
            [`avg_${metric}`]: avgMetric,
            score: score
          });
        }
          
      }
      return data;
    }

    async function generateTimeSeriesData(student, test, metric) {
      // Try to load real data first
      const realData = await loadRealData(student, test, metric);
      
      if (realData && realData.length > 0) {
        // Return real data if available
        return realData;
      }
      
      // Generate mock data as fallback (keep existing mock generation code below)
      const data = [];
      const duration = 3600; // 1 hour
      const points = 120;
      
      for (let i = 0; i < points; i++) {
        const time = (i / points) * duration;
        let period = 'pre-test';
        if (time > 300 && time < 3300) period = 'in-test';
        else if (time >= 3300) period = 'post-test';
        
        let value;
        const stressMultiplier = period === 'in-test' ? 1.5 : 1.0;
        const timeNoise = Math.sin(time / 100) * 0.1 + (Math.random() - 0.5) * 0.2;
        
        switch (metric) {
          case 'HR':
            value = (60 + Math.random() * 20) * stressMultiplier + timeNoise * 10;
            break;
          case 'EDA':
            value = (2 + Math.random() * 4) * stressMultiplier + timeNoise * 2;
            break;
          case 'TEMP':
            value = 36.2 + Math.random() * 1.0 + (stressMultiplier - 1) * 0.8 + timeNoise * 0.3;
            break;
          case 'ACC':
            value = (0.1 + Math.random() * 0.4) * stressMultiplier + timeNoise * 0.1;
            break;
        }
        
        data.push({
          time_seconds: time,
          [metric]: Math.max(0, value),
          period: period,
          timestamp: new Date(Date.now() + time * 1000).toISOString()
        });
      }
      
      return data;
    }

    // Generate min/max envelope data across all students
    async function generateMinMaxData(test, metric) {
      // Try to load real min/max data first
      const realMinMaxData = await loadMinMaxData(test, metric);
      
      if (realMinMaxData && realMinMaxData.length > 0) {
        return realMinMaxData;
      }
      
      // Generate mock min/max data as fallback (keep existing code below)
      const allStudentData = [];
      
      // Generate data for all 10 students
      for (let student = 1; student <= 10; student++) {
        const studentData = await generateTimeSeriesData(student, test, metric);
        allStudentData.push(studentData);
      }
      
      const points = allStudentData[0].length;
      const minMaxData = [];
      
      // Calculate min/max at each time point across all students
      for (let i = 0; i < points; i++) {
        const timePoint = allStudentData[0][i].time_seconds;
        const valuesAtTime = allStudentData.map(studentData => studentData[i][metric]);
        
        minMaxData.push({
          time_seconds: timePoint,
          [`${metric}_min`]: Math.min(...valuesAtTime),
          [`${metric}_max`]: Math.max(...valuesAtTime),
          period: allStudentData[0][i].period
        });
      }
      
      return minMaxData;
    }

    // Find interesting moments in the data
    function findInterestingMoments(data, metric) {
      const values = data.map(d => d[metric]);
      const times = data.map(d => d.time_seconds);
      
      // Find max and min values
      const maxValue = Math.max(...values);
      const minValue = Math.min(...values);
      const maxIndex = values.indexOf(maxValue);
      const minIndex = values.indexOf(minValue);
      
      // Find maximum fluctuation (largest derivative)
      let maxFluctuation = 0;
      let maxFluctuationIndex = 0;
      
      for (let i = 1; i < values.length - 1; i++) {
        const fluctuation = Math.abs(values[i + 1] - values[i - 1]);
        if (fluctuation > maxFluctuation) {
          maxFluctuation = fluctuation;
          maxFluctuationIndex = i;
        }
      }
      
      // Find stress onset (largest increase)
      let maxIncrease = 0;
      let stressOnsetIndex = 0;
      
      for (let i = 5; i < values.length - 5; i++) {
        const before = values.slice(i - 5, i).reduce((a, b) => a + b) / 5;
        const after = values.slice(i, i + 5).reduce((a, b) => a + b) / 5;
        const increase = after - before;
        
        if (increase > maxIncrease) {
          maxIncrease = increase;
          stressOnsetIndex = i;
        }
      }
      
      // Find recovery point (largest decrease during post-test)
      let maxDecrease = 0;
      let recoveryIndex = 0;
      const postTestData = data.filter(d => d.period === 'post-test');
      
      if (postTestData.length > 10) {
        const postTestStart = data.findIndex(d => d.period === 'post-test');
        const postTestValues = postTestData.map(d => d[metric]);
        
        for (let i = 5; i < postTestValues.length - 5; i++) {
          const before = postTestValues.slice(i - 5, i).reduce((a, b) => a + b) / 5;
          const after = postTestValues.slice(i, i + 5).reduce((a, b) => a + b) / 5;
          const decrease = before - after;
          
          if (decrease > maxDecrease) {
            maxDecrease = decrease;
            recoveryIndex = postTestStart + i;
          }
        }
      }
      
      const moments = [
        {
          type: 'max',
          index: maxIndex,
          value: maxValue,
          time: times[maxIndex],
          label: 'Peak Value',
          description: `Highest ${metric}: ${maxValue.toFixed(2)}`,
          color: '#ef4444'
        },
        {
          type: 'min',
          index: minIndex,
          value: minValue,
          time: times[minIndex],
          label: 'Minimum Value',
          description: `Lowest ${metric}: ${minValue.toFixed(2)}`,
          color: '#10b981'
        }
      ];
      
      if (maxFluctuation > 0) {
        moments.push({
          type: 'fluctuation',
          index: maxFluctuationIndex,
          value: values[maxFluctuationIndex],
          time: times[maxFluctuationIndex],
          label: 'High Variability',
          description: `Intense fluctuation (Δ${maxFluctuation.toFixed(2)})`,
          color: '#f59e0b'
        });
      }
      
      if (maxIncrease > 0) {
        moments.push({
          type: 'stress_onset',
          index: stressOnsetIndex,
          value: values[stressOnsetIndex],
          time: times[stressOnsetIndex],
          label: 'Stress Onset',
          description: `Rapid increase (+${maxIncrease.toFixed(2)})`,
          color: '#8b5cf6'
        });
      }
      
      if (maxDecrease > 0 && recoveryIndex > 0) {
        moments.push({
          type: 'recovery',
          index: recoveryIndex,
          value: values[recoveryIndex],
          time: times[recoveryIndex],
          label: 'Recovery',
          description: `Stress recovery (-${maxDecrease.toFixed(2)})`,
          color: '#06b6d4'
        });
      }
      
      return moments;
    }

    // Visualization functions
    function createScatterPlot(containerId, data, metric) {
      const container = d3.select(`#${containerId}`);
      container.selectAll('*').remove();

      const width = 700;
      const height = 550;
      const margin = { top: 20, right: 20, bottom: 60, left: 60 };

      const svg = container.append('svg')
        .attr('viewBox', `0 0 ${width} ${height}`)
        .attr('width', '100%')
        .attr('height', '100%');

      const xField = `avg_${metric}`;
      const yField = 'score';

      const xScale = d3.scaleLinear()
        .domain(d3.extent(data, d => d[xField]))
        .range([margin.left, width - margin.right])
        .nice();

      const yScale = d3.scaleLinear()
        .domain(d3.extent(data, d => d[yField]))
        .range([height - margin.bottom, margin.top])
        .nice();

      const colorScale = d3.scaleOrdinal()
        .domain(d3.range(1, 11))
        .range(['#3b82f6', '#ef4444', '#10b981', '#f59e0b', '#8b5cf6', '#06b6d4', '#f97316', '#84cc16', '#ec4899', '#6366f1']);

      // Add gridlines
      svg.append('g')
        .attr('class', 'gridlines')
        .attr('transform', `translate(0,${height - margin.bottom})`)
        .call(d3.axisBottom(xScale).tickSize(-height + margin.top + margin.bottom).tickFormat(''));

      svg.append('g')
        .attr('class', 'gridlines')
        .attr('transform', `translate(${margin.left},0)`)
        .call(d3.axisLeft(yScale).tickSize(-width + margin.left + margin.right).tickFormat(''));

      // Add axes
      svg.append('g')
        .attr('transform', `translate(0,${height - margin.bottom})`)
        .call(d3.axisBottom(xScale))
        .append('text')
        .attr('x', width / 2)
        .attr('y', 40)
        .attr('fill', 'black')
        .style('text-anchor', 'middle')
        .style('font-size', '14px')
        .text(`Average ${metric}`);

      svg.append('g')
        .attr('transform', `translate(${margin.left},0)`)
        .call(d3.axisLeft(yScale))
        .append('text')
        .attr('transform', 'rotate(-90)')
        .attr('y', -40)
        .attr('x', -height / 2)
        .attr('fill', 'black')
        .style('text-anchor', 'middle')
        .style('font-size', '14px')
        .text('Exam Score');

      // Tooltip
      const tooltip = d3.select('.tooltip');

      // Add dots
      const dots = svg.selectAll('.dot')
        .data(data)
        .enter().append('circle')
        .attr('class', 'dot')
        .attr('cx', d => xScale(d[xField]))
        .attr('cy', d => yScale(d[yField]))
        .attr('r', 8)
        .attr('fill', d => colorScale(d.student))
        .attr('stroke', 'white')
        .attr('stroke-width', 2)
        .style('opacity', 0)
        .style('cursor', 'pointer');

      // Add legend
      const legend = svg.selectAll('.legend')
        .data(d3.range(1, 11))
        .enter().append('g')
        .attr('class', 'legend legend-item')
        .attr('transform', (d, i) => `translate(${width - 100}, ${30 + i * 20})`)
        .style('cursor', 'pointer');

      legend.append('circle')
        .attr('r', 6)
        .attr('fill', d => colorScale(d))
        .attr('stroke', 'white')
        .attr('stroke-width', 1);

      legend.append('text')
        .attr('x', 12)
        .attr('y', 0)
        .attr('dy', '.35em')
        .style('font-size', '12px')
        .style('fill', '#64748b')
        .text(d => `S${d < 10 ? '0' + d : d}`);

      // Add interaction
      dots
        .on('mouseover', function(event, d) {
          d3.select(this).transition().duration(200).attr('r', 12);
          tooltip.transition().duration(200).style('opacity', 1);
          tooltip.html(`
            <strong>Student ${d.student}</strong><br/>
            ${metric}: ${d[xField].toFixed(1)}<br/>
            Score: ${d[yField]}<br/>
            Test: ${d.test}
          `)
          .style('left', (event.pageX + 10) + 'px')
          .style('top', (event.pageY - 10) + 'px');
        })
        .on('mouseout', function() {
          d3.select(this).transition().duration(200).attr('r', 8);
          tooltip.transition().duration(300).style('opacity', 0);
        })
        .on('click', function(event, d) {
          updateStudentDetails(d, metric);
        });

      // Legend interaction
      legend.on('click', function(event, studentId) {
        const isSelected = d3.select(this).classed('selected');
        
        legend.classed('selected', false);
        dots.attr('r', 8).style('opacity', 0.7);
        
        if (!isSelected) {
          d3.select(this).classed('selected', true);
          dots.filter(d => d.student === studentId)
            .attr('r', 12)
            .style('opacity', 1);
        }
      });

      // Drawing interaction
      let isDrawing = false;
      let userLine = null;
      let hasDrawn = false;

      const drawOverlay = svg.append('rect')
        .attr('class', 'draw-overlay')
        .attr('x', margin.left)
        .attr('y', margin.top)
        .attr('width', width - margin.left - margin.right)
        .attr('height', height - margin.top - margin.bottom)
        .style('fill', 'transparent')
        .style('cursor', 'crosshair')
        .style('pointer-events', 'all');

      // Add drawing instructions
      const instructionText = svg.append('text')
        .attr('x', width / 2)
        .attr('y', margin.top + 20)
        .attr('text-anchor', 'middle')
        .style('font-size', '12px')
        .style('fill', '#64748b')
        .style('opacity', 0.8)
        .text('Click and drag to draw your prediction line')
        .style('pointer-events', 'none');

      drawOverlay
        .on('mousedown', function(event) {
          if (hasDrawn) return;
          event.preventDefault();
          isDrawing = true;
          const [mx, my] = d3.pointer(event, this);
          
          userLine = svg.append('line')
            .attr('class', 'user-line')
            .attr('x1', mx)
            .attr('y1', my)
            .attr('x2', mx)
            .attr('y2', my)
            .style('stroke', 'var(--accent-blue)')
            .style('stroke-width', '3px')
            .style('stroke-linecap', 'round')
            .style('pointer-events', 'none');

          // Hide instruction text
          instructionText.style('opacity', 0);
        })
        .on('mousemove', function(event) {
          if (!isDrawing || !userLine) return;
          event.preventDefault();
          const [mx, my] = d3.pointer(event, this);
          userLine.attr('x2', mx).attr('y2', my);
        })
        .on('mouseup', function(event) {
          if (!isDrawing || !userLine) return;
          event.preventDefault();
          isDrawing = false;
          hasDrawn = true;
          
          // Ensure we have a valid line (not just a point)
          const x1 = parseFloat(userLine.attr('x1'));
          const y1 = parseFloat(userLine.attr('y1'));
          const x2 = parseFloat(userLine.attr('x2'));
          const y2 = parseFloat(userLine.attr('y2'));
          
          const distance = Math.sqrt((x2 - x1) ** 2 + (y2 - y1) ** 2);
          
          if (distance > 20) { // Minimum line length
            showBestFitLine(data, xField, yField, xScale, yScale, svg, userLine, metric);
            drawOverlay
              .style('cursor', 'default')
              .style('pointer-events', 'none');
          } else {
            // Line too short, reset
            userLine.remove();
            userLine = null;
            isDrawing = false;
            hasDrawn = false;
            instructionText.style('opacity', 0.8);
          }
        })
        .on('mouseleave', function() {
          if (isDrawing && userLine) {
            // If mouse leaves while drawing, cancel the line
            userLine.remove();
            userLine = null;
            isDrawing = false;
            hasDrawn = false;
            instructionText.style('opacity', 0.8);
          }
        });

      // Show dots with animation only after best fit line is shown
      return { svg, dots, legend, showDots: () => {
        dots.transition()
          .delay((d, i) => i * 50)
          .duration(500)
          .style('opacity', 0.7);
      }};
    }

    function showBestFitLine(data, xField, yField, xScale, yScale, svg, userLine, metric) {
      try {
        // Calculate best fit line
        const n = data.length;
        const sumX = d3.sum(data, d => d[xField]);
        const sumY = d3.sum(data, d => d[yField]);
        const sumXY = d3.sum(data, d => d[xField] * d[yField]);
        const sumX2 = d3.sum(data, d => d[xField] * d[xField]);

        const slope = (n * sumXY - sumX * sumY) / (n * sumX2 - sumX * sumX);
        const intercept = (sumY - slope * sumX) / n;

        const xExtent = d3.extent(data, d => d[xField]);
        
        const bestFitLine = svg.append('line')
          .attr('class', 'best-fit-line')
          .attr('x1', xScale(xExtent[0]))
          .attr('y1', yScale(slope * xExtent[0] + intercept))
          .attr('x2', xScale(xExtent[1]))
          .attr('y2', yScale(slope * xExtent[1] + intercept))
          .style('opacity', 0);

        // Animate best fit line
        bestFitLine.transition()
          .delay(500)
          .duration(1000)
          .style('opacity', 1)
          .on('end', () => {
            // Show dots only after best fit line animation completes
            if (visualizations[metric] && visualizations[metric].showDots) {
              visualizations[metric].showDots();
            }
          });

        // Calculate accuracy
        if (userLine) {
          const userCoords = {
            x1: +userLine.attr('x1'),
            y1: +userLine.attr('y1'),
            x2: +userLine.attr('x2'),
            y2: +userLine.attr('y2')
          };

          const ux1 = xScale.invert(userCoords.x1);
          const uy1 = yScale.invert(userCoords.y1);
          const ux2 = xScale.invert(userCoords.x2);
          const uy2 = yScale.invert(userCoords.y2);

          const userSlope = (uy2 - uy1) / (ux2 - ux1);
          const userIntercept = uy1 - userSlope * ux1;

          // Calculate accuracy based on angle difference and position similarity
          const actualAngle = Math.atan(slope) * 180 / Math.PI;
          const userAngle = Math.atan(userSlope) * 180 / Math.PI;
          const angleDiff = Math.abs(actualAngle - userAngle);

          // Calculate position accuracy by comparing predicted vs actual values at key points
          const xMid = (d3.max(data, d => d[xField]) + d3.min(data, d => d[xField])) / 2;
          const yUserMid = userSlope * xMid + userIntercept;
          const yTrueMid = slope * xMid + intercept;
          const yRange = d3.max(data, d => d[yField]) - d3.min(data, d => d[yField]);
          const positionError = Math.abs(yUserMid - yTrueMid) / yRange;

          // Combine angle and position accuracy (angle is more important)
          const angleAccuracy = Math.max(0, 100 - angleDiff * 2); // 2% penalty per degree
          const positionAccuracy = Math.max(0, 100 - positionError * 100);
          const accuracy = Math.max(0, angleAccuracy * 0.7 + positionAccuracy * 0.3);

          console.log(`Accuracy calculation: angle=${actualAngle.toFixed(1)}°, userAngle=${userAngle.toFixed(1)}°, angleDiff=${angleDiff.toFixed(1)}°, accuracy=${accuracy.toFixed(1)}%`);

          showFeedback(metric, accuracy);
        }
      } catch (error) {
        console.error('Error showing best fit line:', error);
      }
    }

    async function createTimeSeriesPlot(containerId, student, test, metric) {
      const svg = d3.select(`#${containerId}`);
      svg.selectAll('*').remove();

      let data = await generateTimeSeriesData(student, test, metric);
      let minMaxData = await generateMinMaxData(test, metric);
      
      // Further reduce ACC data for time series plots to improve performance
      if (metric === 'ACC') {
        data = data.filter((_, i) => i % 10 === 0); // Take every 10th point for display
        minMaxData = minMaxData.filter((_, i) => i % 10 === 0);
      }
      
      const interestingMoments = findInterestingMoments(data, metric);
      
      const width = 320;
      const height = 200;
      const margin = { top: 20, right: 15, bottom: 40, left: 50 };

      const xScale = d3.scaleLinear()
        .domain(d3.extent(data, d => d.time_seconds))
        .range([margin.left, width - margin.right]);

      const yScale = d3.scaleLinear()
        .domain([
          Math.min(d3.min(data, d => d[metric]), d3.min(minMaxData, d => d[`${metric}_min`])),
          Math.max(d3.max(data, d => d[metric]), d3.max(minMaxData, d => d[`${metric}_max`]))
        ])
        .range([height - margin.bottom, margin.top])
        .nice();

      const line = d3.line()
        .x(d => xScale(d.time_seconds))
        .y(d => yScale(d[metric]))
        .curve(d3.curveMonotoneX);

      // Create area for min/max envelope
      const area = d3.area()
        .x(d => xScale(d.time_seconds))
        .y0(d => yScale(d[`${metric}_min`]))
        .y1(d => yScale(d[`${metric}_max`]))
        .curve(d3.curveMonotoneX);

      const colorScale = d3.scaleOrdinal()
        .domain(['pre-test', 'in-test', 'post-test'])
        .range(['var(--pre-test)', 'var(--in-test)', 'var(--post-test)']);

      // Add background periods
      const periods = test === 'Final' ? [
        { name: 'pre-test', start: -300, end: 0 },
        { name: 'in-test', start: 0, end: 5400 },
        { name: 'post-test', start: 5400, end: 5700 }
      ] : [
        { name: 'pre-test', start: -300, end: 0, label: 'Pre-Test' },
        { name: 'in-test', start: 0, end: 10800, label: 'During Test' },
        { name: 'post-test', start: 10800, end: 11100, label: 'Post-Test' }
      ];

      periods.forEach(period => {
        svg.append('rect')
          .attr('x', xScale(period.start))
          .attr('y', margin.top)
          .attr('width', xScale(period.end) - xScale(period.start))
          .attr('height', height - margin.top - margin.bottom)
          .attr('fill', colorScale(period.name))
          .attr('opacity', 0.15);
      });

      // Add min/max area (grey envelope)
      svg.append('path')
        .datum(minMaxData)
        .attr('fill', '#9ca3af')
        .attr('fill-opacity', 0.3)
        .attr('stroke', 'none')
        .attr('d', area);

      // Add area boundary lines
      svg.append('path')
        .datum(minMaxData)
        .attr('fill', 'none')
        .attr('stroke', '#9ca3af')
        .attr('stroke-width', 1)
        .attr('stroke-dasharray', '2,2')
        .attr('d', d3.line()
          .x(d => xScale(d.time_seconds))
          .y(d => yScale(d[`${metric}_min`]))
          .curve(d3.curveMonotoneX)
        );

      svg.append('path')
        .datum(minMaxData)
        .attr('fill', 'none')
        .attr('stroke', '#9ca3af')
        .attr('stroke-width', 1)
        .attr('stroke-dasharray', '2,2')
        .attr('d', d3.line()
          .x(d => xScale(d.time_seconds))
          .y(d => yScale(d[`${metric}_max`]))
          .curve(d3.curveMonotoneX)
        );

      // Add student's data line
      svg.append('path')
        .datum(data)
        .attr('fill', 'none')
        .attr('stroke', 'var(--accent-purple)')
        .attr('stroke-width', 2.5)
        .attr('d', line);

      // Add interesting moment annotations
      const annotationGroup = svg.append('g').attr('class', 'annotations');

      interestingMoments.forEach((moment, i) => {
        const x = xScale(moment.time);
        const y = yScale(moment.value);

        // Add annotation point
        annotationGroup.append('circle')
          .attr('cx', x)
          .attr('cy', y)
          .attr('r', 4)
          .attr('fill', moment.color)
          .attr('stroke', 'white')
          .attr('stroke-width', 2);

        // Add annotation line and label
        const labelOffset = i % 2 === 0 ? -30 : 25;
        const labelY = y + labelOffset;

        // Annotation line
        annotationGroup.append('line')
          .attr('x1', x)
          .attr('y1', y)
          .attr('x2', x)
          .attr('y2', labelY)
          .attr('stroke', moment.color)
          .attr('stroke-width', 1)
          .attr('stroke-dasharray', '2,2');

        // Annotation background
        const textElement = annotationGroup.append('text')
          .attr('x', x)
          .attr('y', labelY)
          .attr('text-anchor', 'middle')
          .style('font-size', '9px')
          .style('font-weight', '600')
          .style('fill', moment.color);

        textElement.append('tspan')
          .attr('x', x)
          .attr('dy', '-0.5em')
          .text(moment.label);

        textElement.append('tspan')
          .attr('x', x)
          .attr('dy', '1em')
          .style('font-size', '8px')
          .style('font-weight', '400')
          .text(moment.description);

        // Add interactive tooltip for annotations
        const annotationCircle = annotationGroup.select(`circle:nth-child(${i * 3 + 1})`);
        annotationCircle
          .style('cursor', 'pointer')
          .on('mouseover', function(event) {
            d3.select(this).transition().duration(200).attr('r', 6);
            
            const tooltip = d3.select('.tooltip');
            tooltip.transition().duration(200).style('opacity', 1);
            tooltip.html(`
              <strong>${moment.label}</strong><br/>
              ${moment.description}<br/>
              Time: ${Math.floor(moment.time / 60)}:${(moment.time % 60).toFixed(0).padStart(2, '0')}
            `)
            .style('left', (event.pageX + 10) + 'px')
            .style('top', (event.pageY - 10) + 'px');
          })
          .on('mouseout', function() {
            d3.select(this).transition().duration(200).attr('r', 4);
            d3.select('.tooltip').transition().duration(300).style('opacity', 0);
          });
      });

      // Add axes
      svg.append('g')
        .attr('transform', `translate(0,${height - margin.bottom})`)
        .call(d3.axisBottom(xScale).ticks(4).tickFormat(d => `${Math.floor(d/60)}m`))
        .selectAll('text')
        .style('font-size', '9px');

      svg.append('g')
        .attr('transform', `translate(${margin.left},0)`)
        .call(d3.axisLeft(yScale).ticks(4))
        .selectAll('text')
        .style('font-size', '9px');

      // Add labels
      svg.append('text')
        .attr('x', width / 2)
        .attr('y', height - 8)
        .attr('text-anchor', 'middle')
        .style('font-size', '10px')
        .style('fill', 'var(--text-muted)')
        .text('Time');

      svg.append('text')
        .attr('transform', 'rotate(-90)')
        .attr('y', 12)
        .attr('x', -height / 2)
        .attr('text-anchor', 'middle')
        .style('font-size', '10px')
        .style('fill', 'var(--text-muted)')
        .text(metric);

      // Add legend for the grey area
      const legend = svg.append('g')
        .attr('class', 'legend')
        .attr('transform', `translate(${margin.left + 5}, ${margin.top + 5})`);

      legend.append('rect')
        .attr('width', 12)
        .attr('height', 8)
        .attr('fill', '#9ca3af')
        .attr('fill-opacity', 0.3)
        .attr('stroke', '#9ca3af')
        .attr('stroke-width', 1);

      legend.append('text')
        .attr('x', 16)
        .attr('y', 6)
        .style('font-size', '8px')
        .style('fill', 'var(--text-muted)')
        .text('All students range');
    }

    async function updateStudentDetails(studentData, metric) {
      try {
        const studentNameElement = document.querySelector(`#${metric.toLowerCase()}-student-name`);
        const testSvg = `${metric.toLowerCase()}-test`;
        
        if (studentNameElement) {
          studentNameElement.textContent = `Student ${studentData.student} - ${studentData.test}: Score ${studentData.score}`;
        }
        
        await createTimeSeriesPlot(testSvg, studentData.student, studentData.test, metric);
        
        // Add click handler to enlarge
        const timeSeriesElement = document.querySelector(`#${testSvg}`);
        if (timeSeriesElement && timeSeriesElement.parentElement) {
          const timeSeriesContainer = timeSeriesElement.parentElement;
          timeSeriesContainer.style.cursor = 'pointer';
          timeSeriesContainer.onclick = () => openStudentModal(studentData, metric);
        }
      } catch (error) {
        console.error('Error updating student details:', error);
      }
    }

    function showFeedback(metric, accuracy) {
      const feedbackElement = document.querySelector(`#${metric.toLowerCase()}-feedback`);
      if (!feedbackElement) return;
      
      feedbackElement.style.display = 'block';
      
      if (accuracy >= 70) {
        feedbackElement.className = 'feedback-box success';
        feedbackElement.innerHTML = `🎉 Great job! Your prediction accuracy: ${accuracy.toFixed(1)}%`;
      } else {
        feedbackElement.className = 'feedback-box info';
        feedbackElement.innerHTML = `📊 Good try! Your prediction accuracy: ${accuracy.toFixed(1)}%`;
      }
    }

    async function resetVisualization(metric) {
      if (!metric) return;
      
      const chartId = `${metric}-chart`;
      const feedbackId = `${metric.toLowerCase()}-feedback`;
      const studentNameId = `${metric.toLowerCase()}-student-name`;
      const testId = `${metric.toLowerCase()}-test`;
      
      try {
        // Reset feedback
        const feedbackElement = document.getElementById(feedbackId);
        if (feedbackElement) {
          feedbackElement.style.display = 'none';
        }
        
        // Reset student details
        const studentNameElement = document.getElementById(studentNameId);
        if (studentNameElement) {
          studentNameElement.textContent = 'Click on a data point to explore';
        }
        
        const testElement = d3.select(`#${testId}`);
        testElement.selectAll('*').remove();
        
        // Clear existing chart
        d3.select(`#${chartId}`).selectAll('*').remove();
        
        // Recreate visualization
        const data = await generateMetricData(metric);
        visualizations[metric] = createScatterPlot(chartId, data, metric);
      } catch (error) {
        console.error(`Error resetting ${metric} visualization:`, error);
      }
    }

    // Navigation functions
    function showSlide(slideIndex) {
      // Ensure slideIndex is within bounds
      if (slideIndex < 0 || slideIndex >= totalSlides) return;
      
      document.querySelectorAll('.slide').forEach(slide => slide.classList.remove('active'));
      document.querySelectorAll('.nav-dot').forEach((dot, index) => {
        dot.classList.toggle('active', index === slideIndex);
      });
      
      const targetSlide = document.querySelector(`.slide[data-index="${slideIndex}"]`);
      if (targetSlide) {
        targetSlide.classList.add('active');
      }
      
      // Immediately scroll to top with no animation to avoid conflicts
      window.scrollTo(0, 0);
      
      // Also ensure body scroll is reset
      document.body.scrollTop = 0;
      document.documentElement.scrollTop = 0;
      
      updateNavigation(slideIndex);

      // Hide navigation hints after first slide
      if (slideIndex > 0) {
        const nextPageHint = document.getElementById('nextPageHint');
        const scrollHint = document.getElementById('scrollHint');
        if (nextPageHint) nextPageHint.classList.add('hidden');
        if (scrollHint) scrollHint.classList.add('hidden');
      }
      
      // Load visualizations when needed
      if (slideIndex >= 2 && slideIndex <= 5) {
        const metrics = ['HR', 'TEMP', 'EDA', 'ACC']; // Fixed order to match slide indices
        const metric = metrics[slideIndex - 2];
        
        // Clear existing visualization first
        const chartContainer = document.querySelector(`#${metric}-chart`);
        if (chartContainer && !chartContainer.querySelector('svg')) {
          setTimeout(async () => {
            try {
              const data = await generateMetricData(metric);
              visualizations[metric] = createScatterPlot(`${metric}-chart`, data, metric);
            } catch (error) {
              console.error(`Error creating ${metric} visualization:`, error);
            }
          }, 100);
        }
      }
    }

    function changeSlide(direction) {
      const newSlide = currentSlide + direction;
      if (newSlide >= 0 && newSlide < totalSlides) {
        currentSlide = newSlide;
        
        // Force scroll to top before showing new slide
        window.scrollTo(0, 0);
        document.body.scrollTop = 0;
        document.documentElement.scrollTop = 0;
        
        showSlide(currentSlide);
        
        // Ensure we stay at top after slide transition
        setTimeout(() => {
          window.scrollTo(0, 0);
        }, 100);
      }
    }

    function updateNavigation(slideIndex) {
      try {
        const currentSlideElement = document.getElementById('currentSlide');
        const prevBtn = document.getElementById('prevBtn');
        const nextBtn = document.getElementById('nextBtn');
        
        if (currentSlideElement) {
          currentSlideElement.textContent = slideIndex + 1;
        }
        
        if (prevBtn) {
          prevBtn.disabled = slideIndex === 0;
        }
        
        if (nextBtn) {
          nextBtn.disabled = slideIndex === totalSlides - 1;
        }
      } catch (error) {
        console.error('Error updating navigation:', error);
      }
    }

    // Initialize
    document.addEventListener('DOMContentLoaded', function() {
      // Ensure we start at the top of the page
      window.scrollTo(0, 0);
      document.body.scrollTop = 0;
      document.documentElement.scrollTop = 0;
      history.scrollRestoration = 'manual';
      // Set up navigation dots
      document.querySelectorAll('.nav-dot').forEach((dot, index) => {
        dot.addEventListener('click', function() {
          currentSlide = index;
          showSlide(currentSlide);
        });
      });

      // Set up keyboard navigation
      document.addEventListener('keydown', function(e) {
        if (e.key === 'ArrowLeft') changeSlide(-1);
        if (e.key === 'ArrowRight') changeSlide(1);
        if (e.key === 'Escape') closeStudentModal();
      });

      // Set up scroll navigation
      let scrollTimeout;
      let isScrolling = false;
      
      document.addEventListener('wheel', function(e) {
        // Don't navigate if modal is open
        const modal = document.getElementById('studentModal');
        if (modal && modal.classList.contains('show')) {
          return;
        }
        
        if (isScrolling) return;
        
        // Check if we're at the top or bottom of the page
        const isAtTop = window.scrollY <= 10;
        const isAtBottom = (window.innerHeight + window.scrollY) >= document.body.offsetHeight - 10;
        
        clearTimeout(scrollTimeout);
        scrollTimeout = setTimeout(() => {
          if (Math.abs(e.deltaY) > 50) { // Minimum scroll threshold
            isScrolling = true;
            
            if (e.deltaY > 0) {
              // Scrolling down - next slide (only if at bottom or page doesn't scroll)
              if (isAtBottom || document.body.scrollHeight <= window.innerHeight) {
                changeSlide(1);
              }
            } else {
              // Scrolling up - previous slide (only if at top)
              if (isAtTop) {
                changeSlide(-1);
              }
            }
            
            // Reset scrolling flag after animation
            setTimeout(() => {
              isScrolling = false;
            }, 600);
          }
        }, 100);
      }, { passive: false });

      // Set up modal click outside to close
      document.getElementById('studentModal').addEventListener('click', function(e) {
        if (e.target === this) {
          closeStudentModal();
        }
      });

      // Initialize navigation
      updateNavigation(currentSlide);
    });
  </script>
<!-- Navigation Progress -->
  <div class="nav-progress">
    <div class="nav-dot active" data-section="0" data-label="Welcome"></div>
    <div class="nav-dot" data-section="1" data-label="Overview"></div>
    <div class="nav-dot" data-section="2" data-label="Heart Rate"></div>
    <div class="nav-dot" data-section="3" data-label="Temperature"></div>
    <div class="nav-dot" data-section="4" data-label="Skin Conductance"></div>
    <div class="nav-dot" data-section="5" data-label="Movement"></div>
    <div class="nav-dot" data-section="6" data-label="Insights"></div>
  </div>

  <!-- Slide 0: Introduction -->
  <section class="slide active" data-index="0">
    
    <!-- Fun Facts Section -->
    <div class="fun-facts-grid">
      
      <div class="fun-fact-card" style="animation-delay: 0s;">
        <div class="fact-icon">
          <i class="fas fa-heartbeat"></i>
        </div>
        <div class="fact-content">
          <div class="fact-number">2.4 billion</div>
          <div class="fact-text">heartbeats in an average college career</div>
        </div>
      </div>
      <div class="fun-fact-card" style="animation-delay: 0.2s;">
        <div class="fact-icon">
          <i class="fas fa-lightning-bolt"></i>
        </div>
        <div class="fact-content">
          <div class="fact-number">37°C</div>
          <div class="fact-text">optimal brain temperature for peak performance</div>
        </div>
      </div>
      <div class="fun-fact-card" style="animation-delay: 0.4s;">
        <div class="fact-icon">
          <i class="fas fa-clock"></i>
        </div>
        <div class="fact-content">
          <div class="fact-number">15 min</div>
          <div class="fact-text">time for stress hormones to peak</div>
        </div>
      </div>
      <div class="fun-fact-card" style="animation-delay: 0.6s;">
        <div class="fact-icon">
          <i class="fas fa-graduation-cap"></i>
        </div>
        <div class="fact-content">
          <div class="fact-number">85%</div>
          <div class="fact-text">of students experience test anxiety</div>
        </div>
      </div>
    </div>

    <div class="attention-grabber">
      <div class="floating-question">
        <i class="fas fa-brain brain-pulse"></i>
        <span class="question-text" style="color: rgb(41, 88, 69);">What if we could predict exam performance from a heartbeat?</span>
      </div>
      <div class="animated-stats">
        <div class="pulse-indicator">
          <div class="pulse-ring"></div>
          <div class="pulse-ring pulse-ring-delay-1"></div>
          <div class="pulse-ring pulse-ring-delay-2"></div>
          <span class="pulse-bpm">85 BPM</span>
        </div>
        <div class="stress-arrow">
          <i class="fas fa-arrow-right"></i>
          <span>STRESS</span>
        </div>
        <div class="grade-display">
          <div class="grade-number grade-animate">92</div>
          <span class="grade-label">SCORE</span>
        </div>
      </div>
    </div>

  </section>

  <!-- Slide 1: Project Overview -->
  <section class="slide" data-index="1">
    <div class="hero">
      <div class="container">
        <div class="hero-content">
          
          <h1 class="hero-title">Decoding Academic Stress</h1>
          <p class="hero-subtitle">
            Every second, your body tells a story about stress, focus, and performance. 
            We're listening to what it has to say about academic success.
          </p>
          
          <div class="hook-statement">
            <div class="hook-icon">
              <i class="fas fa-lightbulb"></i>
            </div>
            <p class="hook-text">
              During exams, students' heart rates can increase by 40%, skin conductance spikes 300%, 
              and body temperature rises 0.8°C. But which patterns predict success?
            </p>
          </div>
          
          <div class="hero-stats">
            <div class="stat-card">
              <span class="stat-number">10</span>
              <span class="stat-label">Students</span>
            </div>
            <div class="stat-card">
              <span class="stat-number">4</span>
              <span class="stat-label">Metrics</span>
            </div>
            <div class="stat-card">
              <span class="stat-number">3</span>
              <span class="stat-label">Exams</span>
            </div>
            <div class="stat-card">
              <span class="stat-number">30</span>
              <span class="stat-label">Data Points</span>
            </div>
          </div>

          <div class="interactive-demo">
          <div class="brain-model">
            <div class="brain-container">
              <div class="brain-hemisphere brain-left">
                <div class="neural-activity" style="animation-delay: 0s;"></div>
                <div class="neural-activity" style="animation-delay: 0.5s;"></div>
                <div class="neural-activity" style="animation-delay: 1s;"></div>
              </div>
              <div class="brain-hemisphere brain-right">
                <div class="neural-activity" style="animation-delay: 0.3s;"></div>
                <div class="neural-activity" style="animation-delay: 0.8s;"></div>
                <div class="neural-activity" style="animation-delay: 1.3s;"></div>
              </div>
            </div>
            <div class="brain-caption">Neural Activity During Stress</div>
          </div>
        </div>
        </div>
      </div>
    </div>
    <div class="section">
      <div class="container">

        <div class="section-header">
          <h2 class="section-title">Research Overview</h2>
          <p class="section-subtitle">
            Stress significantly impacts academic performance, but the relationship is complex and varies between individuals. 
            This analysis examines physiological stress markers to understand their correlation with exam scores.
          </p>
        </div>

        <div class="metrics-grid">
          <div class="metric-card" data-metric="hr">
            <div class="metric-icon">
              <i class="fas fa-heartbeat"></i>
            </div>
            <h3 class="metric-title">Heart Rate Variability</h3>
            <p class="metric-description">
              Cardiovascular response to stress and cognitive load during examinations
            </p>
          </div>
          
          <div class="metric-card" data-metric="eda">
            <div class="metric-icon">
              <i class="fas fa-bolt"></i>
            </div>
            <h3 class="metric-title">Electrodermal Activity</h3>
            <p class="metric-description">
              Skin conductance reflecting emotional arousal and stress responses
            </p>
          </div>
          
          <div class="metric-card" data-metric="temp">
            <div class="metric-icon">
              <i class="fas fa-thermometer-half"></i>
            </div>
            <h3 class="metric-title">Body Temperature</h3>
            <p class="metric-description">
              Thermal regulation changes in response to psychological stress
            </p>
          </div>
          
          <div class="metric-card" data-metric="acc">
            <div class="metric-icon">
              <i class="fas fa-running"></i>
            </div>
            <h3 class="metric-title">Physical Movement</h3>
            <p class="metric-description">
              Fidgeting and movement patterns indicating restlessness and anxiety
            </p>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Slides 1-4: Metrics -->
  <section class="slide" data-index="2">
    <div class="section">
      <div class="container">
        <div class="viz-container">
          <div class="viz-header">
            <h2 class="viz-title">Heart Rate Analysis</h2>
            <div class="viz-controls">
              <button class="control-btn" onclick="resetVisualization('HR')">Reset</button>
            </div>
          </div>
          <div class="viz-content">
            <div class="chart-panel">
              <div id="HR-chart"></div>
            </div>
            <div class="details-panel">
              <div class="instructions">
                <div class="instructions-title">
                  <i class="fas fa-pencil-alt"></i>
                  Instructions
                </div>
                <div class="instructions-text">
                  Draw a line to predict the relationship between heart rate and exam scores. 
                  Click and drag across the chart area.
                </div>
              </div>
              
              <div class="student-card">
                <div class="student-name" id="hr-student-name">Click on a data point to explore</div>
                <div style="position: relative;">
                  <svg class="time-series-container" id="hr-test"></svg>
                  <div class="expand-hint">Click to enlarge</div>
                </div>
              </div>
              
              <div class="feedback-box" id="hr-feedback"></div>
            </div>
          </div>
          <div class="analysis-writeup">
          <h3 class="writeup-title">
            <i class="fas fa-heartbeat"></i>
            Heart Rate Variability Analysis
          </h3>
          <div class="writeup-content">
            <div class="writeup-section key-findings">
              <h4><i class="fas fa-search"></i> Key Findings</h4>
              <p>Heart rate variability (HRV) serves as a primary indicator of physiological stress during academic examinations. Our analysis shows that there is a positive correlation between average heart rate and grades. Top-performing students may be more engaged or focused during exams, leading to a higher HR. Alternatively, students who are too relaxed (low HR) might not be as focused, hurting their academic performance.</p>
            </div>
            <div class="writeup-section clinical-relevance">
              <h4><i class="fas fa-stethoscope"></i> Suggestion & Discussion</h4>
              <p>Traditionally, increase of heart rate (HR) during examinations has been viewed as a sign of anxiety or distress, which might be assumed to negatively impact academic outcomes. However, our analysis reveals a positive correlation between average heart rate and exam grades, suggesting that a moderately elevated HR may not be solely indicative of anxiety. Instead, it could reflect beneficial states such as alertness, engagement, or cognitive effort.</p>
              <p>While a positive correlation was found between average heart rate and grades, it is critical to acknowledge that correlation does not imply causation. Future studies could explore whether deliberately manipulating HR (for instance, through arousal techniques or relaxation training) has a direct impact on test performance.</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <section class="slide" data-index="4">
    <div class="section">
      <div class="container">
        <div class="viz-container">
          <div class="viz-header">
            <h2 class="viz-title">Electrodermal Activity Analysis</h2>
            <div class="viz-controls">
              <button class="control-btn" onclick="resetVisualization('EDA')">Reset</button>
            </div>
          </div>
          <div class="viz-content">
            <div class="chart-panel">
              <div id="EDA-chart"></div>
            </div>
            <div class="details-panel">
              <div class="instructions">
                <div class="instructions-title">
                  <i class="fas fa-pencil-alt"></i>
                  Instructions
                </div>
                <div class="instructions-text">
                  Draw a line to predict the relationship between skin conductance and exam scores.
                </div>
              </div>
              
              <div class="student-card">
                <div class="student-name" id="eda-student-name">Click on a data point to explore</div>
                <div style="position: relative;">
                  <svg class="time-series-container" id="eda-test"></svg>
                  <div class="expand-hint">Click to enlarge</div>
                </div>
              </div>
              
              <div class="feedback-box" id="eda-feedback"></div>
            </div>
          </div>
          <div class="analysis-writeup">
          <h3 class="writeup-title">
            <i class="fas fa-bolt"></i>
            Electrodermal Activity Analysis
          </h3>
          <div class="writeup-content">
            <div class="writeup-section key-findings">
              <h4><i class="fas fa-search"></i> Key Findings</h4>
              <p>Electrodermal activity (EDA) reflects sympathetic nervous system activation and emotional arousal. Students demonstrate significant EDA spikes during exam. By visualizing and analyzing the data, we found a negative correlation between average electrodermal activity (EDA) during exams and students’ grades. This suggests that physiological arousal, as measured by average EDA, negatively impacts academic performance in an exam setting.</p>
              <p>This fits our intuition: Exam anxiety can hurt performance (e.g., interfering with memory retrieval, focus, or decision-making).</p>
            </div>
            <div class="writeup-section clinical-relevance">
              <h4><i class="fas fa-microscope"></i>	Suggestion & Discussion</h4>
              <p>Mild arousal can actually improve performance (Yerkes-Dodson Law), but too much arousal (stress) impairs it—so, students with moderately low EDA might have the “optimal” level of arousal. In future work, we could try to use a non-linear curve to fit the data and see if there’s a trend.</p>
              <p>Also, instead of relying solely on average EDA as an indicator, future studies could explore more detailed aspects of EDA data, such as fluctuations, peaks, or changes during particularly challenging exam moments. This might reveal subtler patterns in how physiological arousal relates to performance.</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <section class="slide" data-index="3">
    <div class="section">
      <div class="container">
        <div class="viz-container">
          <div class="viz-header">
            <h2 class="viz-title">Temperature Analysis</h2>
            <div class="viz-controls">
              <button class="control-btn" onclick="resetVisualization('TEMP')">Reset</button>
            </div>
          </div>
          <div class="viz-content">
            <div class="chart-panel">
              <div id="TEMP-chart"></div>
            </div>
            <div class="details-panel">
              <div class="instructions">
                <div class="instructions-title">
                  <i class="fas fa-pencil-alt"></i>
                  Instructions
                </div>
                <div class="instructions-text">
                  Draw a line to predict the relationship between body temperature and exam scores.
                </div>
              </div>
              
              <div class="student-card">
                <div class="student-name" id="temp-student-name">Click on a data point to explore</div>
                <div style="position: relative;">
                  <svg class="time-series-container" id="temp-test"></svg>
                  <div class="expand-hint">Click to enlarge</div>
                </div>
              </div>
              
              <div class="feedback-box" id="temp-feedback"></div>
            </div>
          </div>
          <div class="analysis-writeup">
          <h3 class="writeup-title">
            <i class="fas fa-thermometer-half"></i>
            Body Temperature Analysis
          </h3>
          <div class="writeup-content">
            <div class="writeup-section key-findings">
              <h4><i class="fas fa-search"></i> Key Findings</h4>
              <p>Body temperature regulation reflects the body's metabolic response to stress. During exams, students typically show slight temperature increases (0.2-0.8°C) due to heightened cognitive activity and stress response.</p>
              <p>However, the human body tightly regulates its temperature (around 36.5–37.5°C for most people) through homeostasis. Most healthy people’s body temperatures don’t vary much, so there’s not enough variability in temperature to detect a correlation with something as complex as grades.</p>
            </div>
            <div class="writeup-section clinical-relevance">
              <h4><i class="fas fa-heartbeat"></i> Suggestion & Discussion</h4>
              <p>Our visualization and analysis indicate that there is mere significant correlation between average body temperature and academic performance, as measured by student grades. This outcome aligns with current scientific understanding, as body temperature in healthy individuals is regulated within a narrow range and is not considered a determinant of cognitive abilities or academic outcomes.</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <section class="slide" data-index="5">
    <div class="section">
      <div class="container">
        <div class="viz-container">
          <div class="viz-header">
            <h2 class="viz-title">Movement Analysis</h2>
            <div class="viz-controls">
              <button class="control-btn" onclick="resetVisualization('ACC')">Reset</button>
            </div>
          </div>
          <div class="viz-content">
            <div class="chart-panel">
              <div id="ACC-chart"></div>
            </div>
            <div class="details-panel">
              <div class="instructions">
                <div class="instructions-title">
                  <i class="fas fa-pencil-alt"></i>
                  Instructions
                </div>
                <div class="instructions-text">
                  Draw a line to predict the relationship between movement patterns and exam scores.
                </div>
              </div>
              
              <div class="student-card">
                <div class="student-name" id="acc-student-name">Click on a data point to explore</div>
                <div style="position: relative;">
                  <svg class="time-series-container" id="acc-test"></svg>
                  <div class="expand-hint">Click to enlarge</div>
                </div>
              </div>
              
              <div class="feedback-box" id="acc-feedback"></div>
            </div>
          </div>
          <div class="analysis-writeup">
          <h3 class="writeup-title">
            <i class="fas fa-running"></i>
            Movement Pattern Analysis
          </h3>
          <div class="writeup-content">
            <div class="writeup-section key-findings">
              <h4><i class="fas fa-search"></i> Key Findings</h4>
              <p>Physical movement and fidgeting patterns provide insight into anxiety and restlessness levels. We found there is a negative correlation between ACC (Accelerometer) and grades. This suggests that increased physical movement may be associated with lower academic performance.</p>
              <p>Students with moderate movement levels often perform better than those who are completely still (potential freeze response) or excessively fidgety (distraction). </p>
            </div>
            <div class="writeup-section clinical-relevance">
              <h4><i class="fas fa-brain"></i> Suggestion & Discussion</h4>
              <p>The negative correlation between ACC and grades suggests that students who exhibit more physical movement during testing tend to have lower academic performance. This increased movement could be a manifestation of test anxiety, attentional difficulties, or general discomfort. As such, monitoring ACC during exams could serve as an early indicator for educators to identify students who may benefit from interventions aimed at reducing anxiety or detect focus issue (such as ADHD). Future research should investigate whether strategies designed to promote calmness and focus during exams, including deep breath or short meditation, can decrease physical restlessness and thereby enhance academic outcomes.</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Slide 6: Insights & Correlations -->
  <section class="slide" data-index="6">
    <div class="section">
      <div class="container">
        <div class="section-header">
          <h2 class="section-title">Biosignal Correlations & Key Insights</h2>
          <p class="section-subtitle">
            Understanding the statistical relationships between physiological measures and academic performance
          </p>
        </div>

        <!-- Correlation Analysis -->
        <div class="correlation-container">
          <h3 class="correlation-title">
            <i class="fas fa-chart-bar"></i>
            Correlation with Final Grades
          </h3>
          <div class="correlation-grid">
            <div class="correlation-card" data-correlation="0.23">
              <div class="correlation-header">
                <i class="fas fa-heartbeat"></i>
                <span>Heart Rate</span>
              </div>
              <div class="correlation-bar">
                <div class="correlation-fill" style="width: 23%; background: var(--accent-red);"></div>
              </div>
              <div class="correlation-value">r = 0.23</div>
              <div class="correlation-desc">Weak positive correlation</div>
            </div>
            
            <div class="correlation-card" data-correlation="-0.41">
              <div class="correlation-header">
                <i class="fas fa-bolt"></i>
                <span>Skin Conductance</span>
              </div>
              <div class="correlation-bar">
                <div class="correlation-fill negative" style="width: 41%; background: var(--accent-blue);"></div>
              </div>
              <div class="correlation-value">r = -0.41</div>
              <div class="correlation-desc">Moderate negative correlation</div>
            </div>
            
            <div class="correlation-card" data-correlation="0.15">
              <div class="correlation-header">
                <i class="fas fa-thermometer-half"></i>
                <span>Temperature</span>
              </div>
              <div class="correlation-bar">
                <div class="correlation-fill" style="width: 15%; background: var(--accent-yellow);"></div>
              </div>
              <div class="correlation-value">r = 0.15</div>
              <div class="correlation-desc">Very weak positive correlation</div>
            </div>
            
            <div class="correlation-card" data-correlation="-0.32">
              <div class="correlation-header">
                <i class="fas fa-running"></i>
                <span>Movement</span>
              </div>
              <div class="correlation-bar">
                <div class="correlation-fill negative" style="width: 32%; background: var(--accent-green);"></div>
              </div>
              <div class="correlation-value">r = -0.32</div>
              <div class="correlation-desc">Moderate negative correlation</div>
            </div>
          </div>
        </div>

        <!-- Key Findings -->
        <div class="insights-grid">
          <div class="insight-card">
            <div class="insight-icon" style="background: linear-gradient(135deg, #fef3c7, #fcd34d); color: var(--accent-yellow);">
              <i class="fas fa-chart-line"></i>
            </div>
            <h3 class="insight-title">Individual Variation</h3>
            <p class="insight-description">
              Stress responses vary significantly between students (SD = 12.3 BPM), requiring personalized approaches to stress management
            </p>
          </div>
          
          <div class="insight-card">
            <div class="insight-icon" style="background: linear-gradient(135deg, #d1fae5, #6ee7b7); color: var(--accent-green);">
              <i class="fas fa-clock"></i>
            </div>
            <h3 class="insight-title">Temporal Patterns</h3>
            <p class="insight-description">
              Average stress peaks occur 18±7 minutes into exams, with 73% of students showing recovery within 15 minutes post-test
            </p>
          </div>
          
          <div class="insight-card">
            <div class="insight-icon" style="background: linear-gradient(135deg, #fee2e2, #fca5a5); color: var(--accent-red);">
              <i class="fas fa-lightbulb"></i>
            </div>
            <h3 class="insight-title">Predictive Power</h3>
            <p class="insight-description">
              Combined biosignals explain 34% of grade variance (R² = 0.34), suggesting significant but not complete predictive capability
            </p>
          </div>
          
          <div class="insight-card">
            <div class="insight-icon" style="background: linear-gradient(135deg, #ede9fe, #ddd6fe); color: var(--accent-purple);">
              <i class="fas fa-brain"></i>
            </div>
            <h3 class="insight-title">Optimal Arousal</h3>
            <p class="insight-description">
              Students with moderate stress levels (HR +15-25% from baseline) achieved 12% higher scores than high-stress peers
            </p>
          </div>
        </div>

        <!-- Story-telling Summary -->
        <div class="story-summary">
          <h3 class="story-title">
            <i class="fas fa-book-open"></i>
            Story-telling summary:
          </h3>
          <div class="story-subtitle">The Hidden Signals of Exam Success: What Our Bodies Tell Us</div>
          
          <p class="story-text">
            When students sit down for an exam, it's not just their knowledge that's put to the test. Beneath the surface, their bodies are sending signals—tiny physiological messages that, as our research discovered, can reveal surprising truths about performance.
          </p>

          <div class="story-section">
            <h4 class="story-section-title">The Rhythm of the Heart</h4>
            <p class="story-text">
              Let's start with the heart. Heart rate variability (HRV), often thought of as a window into our stress, emerged as a primary indicator during academic exams. Our findings uncovered an unexpected twist: students with a <span class="story-highlight">slightly elevated heart rate tended to score higher</span>. Contrary to what you might assume, a racing heart doesn't always mean anxiety is taking over. Sometimes, it means you're alert, engaged, and giving your all.
            </p>
            <p class="story-text">
              The top performers, it seems, are those whose hearts are "in the game"—literally. In contrast, students who felt too calm—whose heart rates barely budged—didn't fare as well. Perhaps they were too relaxed, or not fully tuned in. The takeaway? <span class="story-highlight">A touch of nerves can sharpen your focus</span>. If you're too mellow before an exam, a quick walk or some energizing music might just give you the boost you need.
            </p>
          </div>

          <div class="story-section">
            <h4 class="story-section-title">Sweat, Stress, and the Power of EDA</h4>
            <p class="story-text">
              Next, we turned our attention to electrodermal activity (EDA)—the measure of your skin's response to stress. During exams, EDA often spikes, and our data showed a clear trend: <span class="story-highlight">students with higher average EDA tended to have lower grades</span>. In other words, too much stress—felt as sweaty palms or nervous tingles—can get in the way of clear thinking and recall.
            </p>
            <p class="story-text">
              Still, there's a sweet spot. Some arousal is good, even necessary, for peak performance (hello, Yerkes-Dodson Law), but when it tips into anxiety, performance suffers. Future research could dig deeper, looking not just at averages, but at how EDA rises and falls during especially tough questions—perhaps revealing moments where the pressure gets to be too much.
            </p>
          </div>

          <div class="story-section">
            <h4 class="story-section-title">Temperature: Not Hot, Not Cold—Just Right</h4>
            <p class="story-text">
              As stress rises, so does body temperature, if only by a fraction of a degree. Students, we saw, typically get a little warmer during exams—evidence of the mind's metabolic demands. But here's the catch: <span class="story-highlight">unlike heart rate or EDA, these tiny changes in temperature didn't predict who would ace the test</span>. That's good news—it means that within the normal range, your body's thermostat doesn't decide your grade.
            </p>
          </div>

          <div class="story-section">
            <h4 class="story-section-title">Movement: The Fidget Factor</h4>
            <p class="story-text">
              Finally, we looked at movement. The accelerometer told its own story: <span class="story-highlight">students who moved around more during exams generally earned lower grades</span>. This could be a sign of restlessness, distraction, or anxiety—or even point to focus issues like ADHD. It's a subtle clue, but one with real implications.
            </p>
            <p class="story-text">
              Teachers and educators might watch for these patterns, stepping in to offer support to students who just can't seem to sit still, perhaps through mindfulness or breathing exercises.
            </p>
          </div>

          <div class="story-summary-section">
            <div class="story-summary-title">In Summary:</div>
            <p class="story-text">
              Our bodies whisper clues about how we're coping with academic pressure. <span class="story-highlight">A little stress is good—it sharpens our minds and readies us for challenge</span>. But too much, whether it shows up as sweaty palms or restless legs, can cloud our thinking and hold us back.
            </p>
            <div class="story-quote">
              The art lies in finding the right balance: engaged, but not overwhelmed; alert, but not anxious. Future studies might reveal even more about these hidden signals, helping every student unlock their best performance.
            </div>
          </div>
        </div>

        <!-- Statistical Summary -->
        <div class="stats-summary">
          <h3 class="stats-title">
            <i class="fas fa-calculator"></i>
            Statistical Summary
          </h3>
          <div class="stats-content">
            <div class="stats-column">
              <h4>Sample Characteristics</h4>
              <ul>
                <li>Sample size: N = 30 observations</li>
                <li>Mean final grade: 72.3 ± 18.6</li>
                <li>Grade range: 33-92 points</li>
                <li>Data collection: 60 hours total</li>
              </ul>
            </div>
            <div class="stats-column">
              <h4>Key Findings</h4>
              <ul>
                <li>Skin conductance strongest predictor (β = -0.41)</li>
                <li>Movement patterns second predictor (β = -0.32)</li>
                <li>Heart rate shows weak positive association</li>
                <li>Temperature least correlated with performance</li>
              </ul>
            </div>
            <div class="stats-column">
              <h4>Clinical Implications</h4>
              <ul>
                <li>Real-time monitoring feasible for intervention</li>
                <li>Personalized stress thresholds recommended</li>
                <li>Early warning systems viable for at-risk students</li>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Modal for enlarged student data -->
  <div class="modal-overlay" id="studentModal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title" id="modalTitle">Student Data Analysis</h3>
        <button class="modal-close" onclick="closeStudentModal()">
          <i class="fas fa-times"></i>
        </button>
      </div>
      <div class="modal-body">
        <div class="student-details">
          <div class="chart-section">
            <svg class="enlarged-chart" id="enlargedChart"></svg>
          </div>
          <div class="stats-section">
            <div class="stat-item">
              <div class="stat-label">Average Value</div>
              <div class="stat-value" id="avgValue">--</div>
            </div>
            <div class="stat-item">
              <div class="stat-label">Peak Value</div>
              <div class="stat-value" id="peakValue">--</div>
            </div>
            <div class="stat-item">
              <div class="stat-label">Min Value</div>
              <div class="stat-value" id="minValue">--</div>
            </div>
            <div class="stat-item">
              <div class="stat-label">Stress Increase</div>
              <div class="stat-value" id="stressIncrease">--</div>
            </div>
            <div class="stat-item">
              <div class="stat-label">Recovery Rate</div>
              <div class="stat-value" id="recoveryRate">--</div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>


  <!-- Tooltip -->
  <div class="tooltip"></div>

  <!-- Navigation Hints -->
  <div class="next-page-hint" id="nextPageHint">
    <span>Click next or scroll to explore</span>
    <i class="fas fa-arrow-right"></i>
  </div>
  
</body>
</html>